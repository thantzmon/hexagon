<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-ca">
<head>
 <title>Pittsylvania County</title>
 <meta http-equiv="X-UA-Compatible" content="IE=9" />
   
    <style type="text/css">
        a{ 
text-decoration: underline; 
} 
a:hover{ /* For when your mouse hovers over the element */ 
text-decoration: underline; 
} 
a:visited{ /* For links that are in the browser history (Previously visited) */ text-decoration: none; 
color: purple; 
} 
a:active{ /* For links that you are clicking on */ 
text-decoration: none; 
color: blue; 
}
        
    .style1 {background-color:#D46D18;white-space:nowrap;font-weight:bold;border:2px #006699 solid;}
    .tooltipx {
        background-color:#ffffff;
        font-weight:bold;
        border:2px #006699 solid;        
      }
    .x-tool-help {
      background:url(images/help.png);
    }
    html, body {
        font:normal 10px verdana;
         background-color:#F0F0F0;
        margin:0;
        padding:0;
        border:0 none;  
        height:100%;
    }
    p {
        margin:5px;
    }
    
.highlight {
    background-color: yellow;
}
 
.ui-btn-text {
    font-size: 8px; /* Play with font size of the text */
}
    
    
    .mybutton-text-icon .x-btn-center .x-btn-text { 
      background-position: 0 2px;
      background-repeat: no-repeat;     
        height: 20px;
        width: 75px;
    } 
    .ui-layout-north  {
        background-color:#F0F0F0 !important;        
    z-index: 99999 !important; 
    overflow: visible;
    

} 
  .ui-layout-west  {
        background-color:#F0F0F0 !important;          
    }
 .ui-layout-east  {
        background-color:#F0F0F0 !important; 
        width: 100 !important;        
    }
     .ui-layout-south  
     {   
        background-color:#F0F0F0 !important;          
    }
    .ui-layout-center {   padding-top: 0px !important;  
     padding-right: 0px !important;  
       padding-bottom: 0px !important;  
       padding-left: 0px !important; 
       overflow: hidden !important; 
}
        .ui-tabs-nav {
                /* don't need border or rounded corners - tabs 'fill' the pane */
                border-top:     0;
                border-left:    0;
                border-right:   0;
                padding-bottom: 0 !important;
                -moz-border-radius:     0;
                -webkit-border-radius:  0;
            }


    .button.ui-datepicker-trigger {
    font-size: 65% !important;
    vertical-align: top !important;
    margin-left: 3px !important;
}
 .button {
    display: inline-block;
    line-height: 1;
    padding: 7px 10px;
    text-decoration: none;
    font-weight: bold;
    color: #fff;
    background-color: #39c;
    -moz-border-radius: 5px;
    -webkit-border-radius: 5px;
    -khtml-border-radius: 5px;
    border-radius: 5px;
}
input.button, button.button {
    border: 0px none;
}
.ui-button.ui-widget{ width: 50; }   
.ui-dialog{ position: absolute; overflow:hidden }
   #accordion .ui-accordion-content { padding: 0; }
     #streetaccord .ui-accordion-content { padding: 0; }
    #saccord .ui-accordion-content { padding: 1em; }
 #saveasb .ui-accordion-content { padding: 1em; }
 #gaccord .ui-accordion-content { padding: 1em; }


     input.htwd {
    width: 25px; margin-top: 5px;
}


</style>


     

        <link rel="stylesheet" href="script/themes/base/jquery.ui.all.css"/>
    <link href="script/themes/infragistics/infragistics.theme.css" rel="stylesheet" type="text/css" />
<link href="script/structure/infragistics.css" rel="stylesheet" type="text/css" />
  

        <link rel="stylesheet" href="script/themes/base/layout-default-latest.css"/>     
    <link rel="stylesheet" href="Script/GSCMapV1.0.css" type="text/css" charset="utf-8"/>
   <script type="text/javascript" src="http://serverapi.arcgisonline.com/jsapi/arcgis/?v=2.7"></script>
<link href="http://serverapi.arcgisonline.com/jsapi/arcgis/2.7/js/dojo/dijit/themes/claro/claro.css" rel="stylesheet" type="text/css" >
   <link rel="stylesheet" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.3/js/dojo/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.3/js/esri/css/esri.css">
   <script type="text/javascript" src="Script/jquery-1.7.1.min.js"></script>

  
  
   <script type="text/javascript" src="Script/jquery-ui.min.js"></script>

  <script src="Script/infragistics.js" type="text/javascript"></script>



    
      
    <script type="text/javascript" src="Script/ui/jquery.layout-latest.js"></script>

     <script type="text/javascript" src="util.js"></script>
   

       <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?&libraries=geometry&amp;v=3.15&amp;client=gme-sungardpublicsector"></script>  
  
        
    <script src="Script/GSCMapV1a.1.js" type="text/javascript"></script>
  <script src="Script/keydragzoom.js" type="text/javascript"></script>

 

 
 
  <script type="text/javascript" src="Script/arcgislink.js"></script> 
 
 
 <script type="text/javascript" src="labels.js"></script>


    <script type="text/javascript">

        var sposx = "";
        var sposy;
        var sdist = 0;
   
        var circle;
        var lyrs = new Array(20);
        var iname = new Array(20);
        var lyrcount = 0;

        var prtstr = "";
        var geocoder;
        var cenx;
        var ceny;
        var line = null;
        var polylineCount = 0;
        var polylinePoints = [];
        var polyline;

        var statestr = "";
        var stcntystr = "";
        var stpick = "";
        var polylines = [];

        var doit;


            var gic = "true";
        var pcval = "";
            var infolyr = "Parcels";



        function resizedw() {
            map.Refresh();
         //   map.refreshOverlay();
        }
        $(window).resize(function () {
            clearTimeout(doit);
            doit = setTimeout(function () {
                resizedw();
            }, 100);
        });

        function myWidgetResizer() {
            if (map != null) {
             //   alert("bite me");
               map.Refresh();
            // map.refreshOverlay();
            }
        }
      
        function toggleLiveResizing() {
            $.each($.layout.config.borderPanes, function (i, pane) {
                var o = myLayout.options[pane];
                o.livePaneResizing = !o.livePaneResizing;
            });
        };

        function toggleStateManagement(skipAlert, mode) {
            if (!$.layout.plugins.stateManagement) return;

            var options = myLayout.options.stateManagement
        , enabled = options.enabled // current setting
        ;
            if ($.type(mode) === "boolean") {
                if (enabled === mode) return; // already correct
                enabled = options.enabled = mode
            }
            else
                enabled = options.enabled = !enabled; // toggle option

            if (!enabled) { // if disabling state management...
                myLayout.deleteCookie(); // ...clear cookie so will NOT be found on next refresh
                if (!skipAlert)
                    alert('This layout will reload as the options specify \nwhen the page is refreshed.');
            }
            else if (!skipAlert)
                alert('This layout will save & restore its last state \nwhen the page is refreshed.');

            // update text on button
            var $Btn = $('#btnToggleState'), text = $Btn.html();
         //   if (enabled)
         //       $Btn.html(text.replace(/Enable/i, "Disable"));
          //  else
           //     $Btn.html(text.replace(/Disable/i, "Enable"));
        };

        // set EVERY 'state' here so will undo ALL layout changes
        // used by the 'Reset State' button: myLayout.loadState( stateResetSettings )
        var stateResetSettings = {
            north__size: 30
    , north__initClosed: false
    , north__initHidden: false
    , south__size: 5
    , south__initClosed: false
    , south__initHidden: true
    , west__size: 190
    , west__initClosed: false
    , west__initHidden: false
    , east__size: 10
    , east__initClosed: true
    , east__initHidden: true
        };

        var myLayout;
        var $dialog;
        var themevars = new Array(25);
        var themetabs = new Array(25);
        var themecols = new Array(25);
        var togon = true;
        $(document).ready(function () {




            // this layout could be created with NO OPTIONS - but showing some here just as a sample...
            // myLayout = $('body').layout(); -- syntax with No Options

            myLayout = $('body').layout({

                //  reference only - these options are NOT required because 'true' is the default
                closable: true  // pane can open & close
        , resizable: false  // when open, pane can be resized 
        , slidable: true    // when closed, pane can 'slide' open over other panes - closes on mouse-out
        , livePaneResizing: true

                //  some resizing/toggling settings
        , north__slidable: false    // OVERRIDE the pane-default of 'slidable=true'
        , north__togglerLength_closed: '100%'   // toggle-button is full-width of resizer-bar
        , north__spacing_closed: 20     // big resizer-bar when open (zero height)
                , north__size: 70
         , south__resizable: false  // OVERRIDE the pane-default of 'resizable=true'
                //  , south__spacing_open: 0        // no resizer-bar when open (zero height)
                // , south__spacing_closed: 20      // big resizer-bar when open (zero height)

                //  some pane-size settings
                    , south__size: 1
        , west__minSize: 20
            , west__size: 220
        , east__animatePaneSizing: true
        , east__fxSpeed_size: "fast"    // 'fast' animation when resizing west-pane
        , east__fxSpeed_open: 1000  // 1-second animation when opening west-pane
        , east__fxSettings_open: { easing: "easeOutBounce"} // 'bounce' effect when opening
        , east__fxName_close: "none"    // NO animation when closing west-pane
            , east__size: 180
                , east__minSize: 180
               , east__maxSize: 180 // .5 50% of layout width
        , center__minWidth: 100
        , center__onresize: myWidgetResizer
        , center__triggerEventsOnLoad: true
                //  some pane animation settings
        , west__animatePaneSizing: false
        , west__fxSpeed_size: "fast"    // 'fast' animation when resizing west-pane
        , west__fxSpeed_open: 1000  // 1-second animation when opening west-pane
        , west__fxSettings_open: { easing: "easeOutBounce"} // 'bounce' effect when opening
        , west__fxName_close: "none"    // NO animation when closing west-pane

                //  enable showOverflow on west-pane so CSS popups will overlap north pane
                //   , west__showOverflowOnHover: true

                //  enable state management
        , stateManagement__enabled: true // automatic cookie load & save enabled by default

        , showDebugMessages: true // log and/or display messages from debugging & testing code
            });

            // if there is no state-cookie, then DISABLE state management initially
            var cookieExists = !$.isEmptyObject(myLayout.readCookie());
            if (!cookieExists) toggleStateManagement(true, false);

            myLayout
            // add event to the 'Close' button in the East pane dynamically...
            //  .bindButton('#btnCloseEast', 'close', 'east')

            // add event to the 'Toggle South' buttons in Center AND South panes dynamically...
            //  .bindButton('.south-toggler', 'toggle', 'south')

            // add MULTIPLE events to the 'Open All Panes' button in the Center pane dynamically...
            //  .bindButton('#openAllPanes', 'open', 'north')
            //  .bindButton('#openAllPanes', 'open', 'south')
            //  .bindButton('#openAllPanes', 'open', 'west')
            //  .bindButton('#openAllPanes', 'open', 'east')

            // add MULTIPLE events to the 'Close All Panes' button in the Center pane dynamically...
            //  .bindButton('#closeAllPanes', 'close', 'north')
            //  .bindButton('#closeAllPanes', 'close', 'south')
            //  .bindButton('#closeAllPanes', 'close', 'west')
            //  .bindButton('#closeAllPanes', 'close', 'east')

            // add MULTIPLE events to the 'Toggle All Panes' button in the Center pane dynamically...
            //  .bindButton('#toggleAllPanes', 'toggle', 'north')
            //  .bindButton('#toggleAllPanes', 'toggle', 'south')
            //  .bindButton('#toggleAllPanes', 'toggle', 'west')
            //  .bindButton('#toggleAllPanes', 'toggle', 'east')
        ;

            // 'Reset State' button requires updated functionality in rc29.15+
            if ($.layout.revision && $.layout.revision >= 0.032915)
                $('#btnReset').show();




            $("input:checkbox").live("click", function (event) {

                if ($(this).is(':checked')) {
                    check(event.target.id, event.target.name, event.target.title);
                } else {
                    uncheck(event.target.id, event.target.name, event.target.title);
                }
            });




    //        $('#rbut').on('click', function () {
             //   if (togon) {
             //       addruler(map.gmap);
//                  togon = false;
//                  $("#rbut").html('Off');
//              } else {
//                  removeruler();
//                  togon = true;
//                  $("#rbut").html('On');
    //            });
         //        $('#rbut2').on('click', function () {
//              if (togon) {
//                  addruler(map.gmap);
//                  togon = false;
//                  $("#rbut").html('Off');
//              } else {
    //                removeruler();
//                  togon = true;
//                  $("#rbut").html('On');
//              }
//});
                //              var distanceWidget = new DistanceWidget(map.gmap);
                //              map.Refresh();
                //              displayInfo(distanceWidget);

                //              google.maps.event.addListener(distanceWidget, 'distance_changed', function () {
                //                  displayInfo(distanceWidget);
                //              });

                //              google.maps.event.addListener(distanceWidget, 'position_changed', function () {
                //                  displayInfo(distanceWidget);
                //              });

          //  });


            $('body').on('click', '.mylabel', function (event) {
              //  alert(event.target.tagName);
             //   $(this).toggleClass('highlight', this);

                var selector = '.mylabel';
                $(selector).each(function () {
                    $(this).removeClass('highlight');
                });

                $(this).toggleClass('highlight', this);


                infolyr = event.target.innerText;
                });
    $('#simage').on('click', function () {

                saveasimage();
            });

       $('#rbut').on('click', function () {
             //   if (togon) {
               gic = "false";
       
                });
                 $('#rbut2').on('click', function () {
             
                  gic = "true";
                  measureReset();
 
});



            $('#dbtn').on('click', function () {
                var sfor = stext.value;
                //  if (sposx != "") {
                getData(sfor);
                // }
            });


            $('#cdw').on('click', function () {
                cleardwid();
            });

            $('#exp').on('click', function () {
                expexl();
            });

            $("#pfor").on('click', function () {
                pformat();
            });

            $("#pcard").on('click', function () {
                pcard();
            });

            $("#showdd").on('click', function () {
                var options = {
                      modal: true, 
                      height: 300,      
                      minHeight: 100,
                      minWidth: 600,
                      maxWidth: 700,
                      maxHeight: 500,
                };


                $(function () { $("#dialog").dialog(options); });
                //   $("#dialog").dialog("open");
            });
          
              $(".parClass").on("click", "#gridTable tr", function (e) {
                    var mytd = $(this).html();             

                var n = mytd.lastIndexOf("GRID_NO_Z");
                var ltd = mytd.lastIndexOf("<td>");
                var ltde = mytd.lastIndexOf("</td>");
                var value = mytd.substring(ltd + 4, ltde);

                if (n != -1) {
                    window.open('http://caplus.myossi.com/GSCWebP/ZoningImages/' + value + '.pdf');

                } else {
                    var n = mytd.lastIndexOf("GRID_NO");
                    var ltd = mytd.lastIndexOf("<td>");
                    var ltde = mytd.lastIndexOf("</td>");
                    var value = mytd.substring(ltd + 4, ltde);
                    if (n != -1) {
                        window.open('http://caplus.myossi.com/GSCWebP/TaxImages/' + value + '.pdf');
                    }
                         else {
                        var n = mytd.lastIndexOf("ALPHA");
                        var ltd = mytd.lastIndexOf("<td>");
                        var ltde = mytd.lastIndexOf("</td>");
                        var value = mytd.substring(ltd + 4, ltde);
                        if (n != -1) {
                            window.open('http://caplus.myossi.com/GSCWebP/TaxImages/' + value + '.pdf');
                        }
                        }
                }


            });


            var loading = false;
            var myArr = [];


            //          var prefixText = $('input#qsstate').val();
            //  
            //      $.ajax({
            //          type: "GET",
            //          url: "WebService.asmx/GetState", // change to full path of file on server
            //            data: "prefixText=" + prefixText,
            //          dataType: "xml",
            //          success: parseXml,
            //          complete: setupAC,
            //          failure: function(data) {
            //              alert("XML File could not be found");
            //              }
            //      });
            //  
            //      function parseXml(xml)
            //      {
            //          //find every query value
            //          $(xml).find("name").each(function()
            //          {
            //              myArr.push($(this).attr("content"));
            //          }); 
            //      }
            //      
            //      function setupAC() {
            //          $("input#qsstate").autocomplete({
            //                  source: myArr,
            //                  minLength: 2,
            //                  select: function(event, ui) {
            //                      $("input#qsstate").val(ui.item.value);
            //                  //  $("#searchForm").submit();
            //                  }
            //          });
            //      }

            $("#qowner").autocomplete({
                appendTo: "body",
                source: function (request, response) {

                    /* Beginning of an AJAX request; set loading to true */
                    //    loading = true;
                    //    var prefixText = settings.data.call(this.element[0], request.term);
                    var prefixText = $('input#qowner').val();

                    $.ajax({
                        type: "GET",
                        url: "WebService.asmx/GetOwner",
                        data: "prefixText=" + prefixText,
                        dataType: "xml",
                        success: function (xmlres, textStatus, $xhr) {
                            myArr.length = 0;
                            $(xmlres).find("data").each(function () {
                                myArr.push($(this).find('name').text() + "," + $(this).find('content').text());
                            });

                            response(myArr);
                        },
                        error: function ($xhr, textStatus) {
                            response([]);
                        }
                    });

                },
                data: myArr,
                minLength: 2,
                autoFocus: true,
                select: function (event, ui) {
                    //  var stpick = $("input#qsstate").val(ui.item.value);

                    for (var i = 0; i < polylines.length; i++) {

                        map.ClearPolylineOnGoogleMap(polylines[i]);
                    }

                    polylines = [];

                    svalue = ui.item.value;

                    var partsOfStr = svalue.split(',');
                    /* prevent the user from selecting an item if we're still loading matches */
                    // return !loading;
                    //   var hw = gmap.GetWidthHeight();
                    var nameval = "";
                    if (partsOfStr.length > 2) {
                        nameval = partsOfStr[2];
                    }
                    else {
                        nameval = partsOfStr[1];
                    }
                    pcval = nameval;
                    var bbox = map.GetBoundingBox();
                    $.ajax({
                        type: "GET",
                        url: "search.aspx",
                        data: "&skey=pin" + "&svalue=" + nameval + "&canht=" + map.height + "&canwd=" + map.width + "&boundne=" + bbox.top + "," + bbox.right + "&boundsw=" + bbox.bottom + "," + bbox.left,
                        dataType: "xml",
                        success: function (xmlres, textStatus, $xhr) {

                            $(xmlres).find("line").each(function () {

                                var polylinepts = []; 
                                    polystr = "";
                                $(this).find("point").each(function () {
                                    latitude = parseFloat($(this).attr('lat'));
                                    longitude = parseFloat($(this).attr('lng'));
                                    polylinepts.push(new google.maps.LatLng(latitude, longitude));
                                         polystr = polystr + latitude.toString() + "," + longitude.toString() + "|";
                                });


                                var lined = new google.maps.Polyline({
                                    path: polylinepts,
                                    strokeColor: '#0000ff',
                                    strokeOpacity: 1.0,
                                    strokeWeight: 3
                                });
                                map.DrawPolylineOnGoogleMap(lined);

                                polylines.push(lined);

                            });

                            var bb = {};
                            bb.left = $(xmlres).find("bbounds").attr('minlng');
                            bb.top = $(xmlres).find("bbounds").attr('maxlat');
                            bb.right = $(xmlres).find("bbounds").attr('maxlng');
                            bb.bottom = $(xmlres).find("bbounds").attr('minlat');
                            map.ZoomToBoundingBox(bb, false);
                            map.Refresh();
                            var htmltab = "<table border=1 cellspacing=0>";
                            //   $("div#dialog").append("<div><P>Test Test</P></div>"); 
                            //   $dialog.dialog({ title: clickinci });
                            prtstr = "<TABLE BORDER=0 CELLSPACING=0 BORDERCOLOR='#000000' CELLPADDING=0 WIDTH='450'><TR><TD>";
                            $(xmlres).find('data').each(function () {
                                var nme = $(this).find('name').text();
                                var cnt = $(this).find('content').text();
                                htmltab = htmltab + "<tr><td>" + nme + "</td><td>" + cnt + "</td><tr>";
                                prtstr = prtstr + "<tr><td><pre><span class='inner-pre' style='font-size: 8px'>" + nme + "</span></pre></td><td><pre><span class='inner-pre' style='font-size: 8px'>" + cnt + "</span></pre></td><tr>";
                            })
                            htmltab = htmltab + "</table>";
                            $("#intab").html("<div>" + htmltab + "</div>");
                            //  getData(stpick);
                        },
                        error: function ($xhr, textStatus) {
                            response([]);
                        }
                    });



                }

            });

            $("#qpin").autocomplete({
                appendTo: "body",
                source: function (request, response) {

                    var prefixText = $('input#qpin').val();
                    //  stcntystr = prefixText;
                    $.ajax({
                        type: "GET",
                        url: "WebService.asmx/GetPin",
                        data: "prefixText=" + prefixText,
                        dataType: "xml",
                        success: function (xmlres, textStatus, $xhr) {
                            myArr.length = 0;
                            $(xmlres).find("data").each(function () {
                                myArr.push($(this).find('content').text());
                            });

                            response(myArr);
                        },
                        error: function ($xhr, textStatus) {
                            response([]);
                        }
                    });


                },
                data: myArr,
                minLength: 4,
                autoFocus: true,
                select: function (event, ui) {
                    for (var i = 0; i < polylines.length; i++) {
                        map.ClearPolylineOnGoogleMap(polylines[i]);
                    }

                    polylines = [];

                    var skey = "pin";
                    var svalue = ui.item.value;
                    pcval = svalue;
                    var bbox = map.GetBoundingBox();
                    $.ajax({
                        type: "GET",
                        url: "search.aspx",
                        data: "&skey=pin" + "&svalue=" + svalue + "&canht=" + map.height + "&canwd=" + map.width + "&boundne=" + bbox.top + "," + bbox.right + "&boundsw=" + bbox.bottom + "," + bbox.left,
                        dataType: "xml",
                        success: function (xmlres, textStatus, $xhr) {
                            $(xmlres).find("line").each(function () {

                                var polylinepts = [];
                                         polystr = "";
                                $(this).find("point").each(function () {
                                    latitude = parseFloat($(this).attr('lat'));
                                    longitude = parseFloat($(this).attr('lng'));
                                    polylinepts.push(new google.maps.LatLng(latitude, longitude));
                                          polystr = polystr + latitude.toString() + "," + longitude.toString() + "|";
                                });


                                var lined = new google.maps.Polyline({
                                    path: polylinepts,
                                    strokeColor: '#0000ff',
                                    strokeOpacity: 1.0,
                                    strokeWeight: 3
                                });
                                map.DrawPolylineOnGoogleMap(lined);

                                polylines.push(lined);

                            });

                            //                          var lined = new google.maps.Polygon({
                            //                              path: paths,
                            //                              strokeWeight: 3,
                            //                              fillColor: '#55FF55',
                            //                              fillOpacity: 0.5

                            //                          });


                            //  map.DrawPolylinesOnGoogleMap(paths);
                            var bb = {};
                            bb.left = $(xmlres).find("bbounds").attr('minlng');
                            bb.top = $(xmlres).find("bbounds").attr('maxlat');
                            bb.right = $(xmlres).find("bbounds").attr('maxlng');
                            bb.bottom = $(xmlres).find("bbounds").attr('minlat');

                            map.ZoomToBoundingBox(bb, false);
                            map.Refresh();
                            //   polyline = new google.maps.Polyline(polylinePoints, color, width, 1, { clickable: false });
                            //  map.addOverlay(polyline);
                            var htmltab = "<table border=1 cellspacing=0>";
                            //   $("div#dialog").append("<div><P>Test Test</P></div>"); 
                            //   $dialog.dialog({ title: clickinci });
                            $(xmlres).find('data').each(function () {
                                var nme = $(this).find('name').text();
                                var cnt = $(this).find('content').text();
                                htmltab = htmltab + "<tr><td>" + nme + "</td><td>" + cnt + "</td><tr>";
                            })
                            htmltab = htmltab + "</table>";
                            $("#intab").html("<div>" + htmltab + "</div>");



                            //  getData(svalue);
                        },
                        error: function ($xhr, textStatus) {
                            response([]);
                        }
                    });

                }

            });

            $("#qparid").autocomplete({
                appendTo: "body",
                source: function (request, response) {

                    var prefixText = $('input#qparid').val();
                    //    stcntystr = prefixText;
                    $.ajax({
                        type: "GET",
                        url: "WebService.asmx/GetSparid",
                        data: "prefixText=" + prefixText,
                        dataType: "xml",
                        success: function (xmlres, textStatus, $xhr) {
                            myArr.length = 0;
                            $(xmlres).find("data").each(function () {
                                myArr.push($(this).find('name').text());
                            });

                            response(myArr);
                        },
                        error: function ($xhr, textStatus) {
                            response([]);
                        }
                    });


                },
                data: myArr,
                minLength: 4,
                autoFocus: true,
                select: function (event, ui) {

                    for (var i = 0; i < polylines.length; i++) {
                        map.ClearPolylineOnGoogleMap(polylines[i]);
                    }

                    polylines = [];

                    svalue = ui.item.value;
                    var bbox = map.GetBoundingBox();
                    $.ajax({
                        type: "GET",
                        url: "search.aspx",
                        data: "&skey=parid" + "&svalue=" + svalue + "&canht=" + map.height + "&canwd=" + map.width + "&boundne=" + bbox.top + "," + bbox.right + "&boundsw=" + bbox.bottom + "," + bbox.left,
                        dataType: "xml",
                        success: function (xmlres, textStatus, $xhr) {

                            $(xmlres).find("line").each(function () {

                                var polylinepts = [];
                                    polystr = "";
                                $(this).find("point").each(function () {
                                    latitude = parseFloat($(this).attr('lat'));
                                    longitude = parseFloat($(this).attr('lng'));
                                    polylinepts.push(new google.maps.LatLng(latitude, longitude));
                                          polystr = polystr + latitude.toString() + "," + longitude.toString() + "|";
                                });


                                var lined = new google.maps.Polyline({
                                    path: polylinepts,
                                    strokeColor: '#0000ff',
                                    strokeOpacity: 1.0,
                                    strokeWeight: 3
                                });
                                map.DrawPolylineOnGoogleMap(lined);

                                polylines.push(lined);

                            });


                            var bb = {};
                            bb.left = $(xmlres).find("bbounds").attr('minlng');
                            bb.top = $(xmlres).find("bbounds").attr('maxlat');
                            bb.right = $(xmlres).find("bbounds").attr('maxlng');
                            bb.bottom = $(xmlres).find("bbounds").attr('minlat');


                            map.ZoomToBoundingBox(bb, false);
                            map.Refresh();
                            var htmltab = "<table border=1 cellspacing=0>";
                            //   $("div#dialog").append("<div><P>Test Test</P></div>"); 
                            //   $dialog.dialog({ title: clickinci });
                            $(xmlres).find('data').each(function () {
                                var nme = $(this).find('name').text();
                                var cnt = $(this).find('content').text();
                                if (nme == "JOIN_GPIN") {
                                    pcval = cnt;
                                }
                                htmltab = htmltab + "<tr><td>" + nme + "</td><td>" + cnt + "</td><tr>";
                            })
                            htmltab = htmltab + "</table>";
                            $("#intab").html("<div>" + htmltab + "</div>");

                            //   polyline = new google.maps.Polyline(polylinePoints, color, width, 1, { clickable: false });
                            //  map.addOverlay(polyline);
                            //  getData(stpick);
                        },
                        error: function ($xhr, textStatus) {
                            response([]);
                        }
                    });

                }

            });

            $("#qdbpg").autocomplete({
                appendTo: "body",
                source: function (request, response) {

                    var prefixText = $('input#qdbpg').val();
                    //    stcntystr = prefixText;
                    $.ajax({
                        type: "GET",
                        url: "WebService.asmx/GetDbpg",
                        data: "prefixText=" + prefixText,
                        dataType: "xml",
                        success: function (xmlres, textStatus, $xhr) {
                            myArr.length = 0;
                            $(xmlres).find("data").each(function () {
                                myArr.push($(this).find('content').text());
                            });

                            response(myArr);
                        },
                        error: function ($xhr, textStatus) {
                            response([]);
                        }
                    });


                },
                data: myArr,
                minLength: 4,
                autoFocus: true,
                select: function (event, ui) {

                    for (var i = 0; i < polylines.length; i++) {
                        map.ClearPolylineOnGoogleMap(polylines[i]);
                    }
                    polylines = [];
                    svalue = ui.item.value;
                    var bbox = map.GetBoundingBox();
                    $.ajax({
                        type: "GET",
                        url: "search.aspx",
                        data: "&skey=dbpg" + "&svalue=" + svalue + "&canht=" + map.height + "&canwd=" + map.width + "&boundne=" + bbox.top + "," + bbox.right + "&boundsw=" + bbox.bottom + "," + bbox.left,
                        dataType: "xml",
                        success: function (xmlres, textStatus, $xhr) {
                            $(xmlres).find("line").each(function () {

                                var polylinepts = [];
                                    polystr = "";
                                $(this).find("point").each(function () {
                                    latitude = parseFloat($(this).attr('lat'));
                                    longitude = parseFloat($(this).attr('lng'));
                                    polylinepts.push(new google.maps.LatLng(latitude, longitude));
                                               polystr = polystr + latitude.toString() + "," + longitude.toString() + "|";
                                });


                                var lined = new google.maps.Polyline({
                                    path: polylinepts,
                                    strokeColor: '#0000ff',
                                    strokeOpacity: 1.0,
                                    strokeWeight: 3
                                });
                                map.DrawPolylineOnGoogleMap(lined);

                                polylines.push(lined);

                            });

                            var bb = {};
                            bb.left = $(xmlres).find("bbounds").attr('minlng');
                            bb.top = $(xmlres).find("bbounds").attr('maxlat');
                            bb.right = $(xmlres).find("bbounds").attr('maxlng');
                            bb.bottom = $(xmlres).find("bbounds").attr('minlat');

                            map.ZoomToBoundingBox(bb, false);
                            map.Refresh();
                            var htmltab = "<table border=1 cellspacing=0>";
                            //   $("div#dialog").append("<div><P>Test Test</P></div>"); 
                            //   $dialog.dialog({ title: clickinci });
                            $(xmlres).find('data').each(function () {
                                var nme = $(this).find('name').text();
                                var cnt = $(this).find('content').text();
                                if (nme == "JOIN_GPIN") {
                                    pcval = cnt;
                                }
                                htmltab = htmltab + "<tr><td>" + nme + "</td><td>" + cnt + "</td><tr>";
                            })
                            htmltab = htmltab + "</table>";
                            $("#intab").html("<div>" + htmltab + "</div>");

                            //   polyline = new google.maps.Polyline(polylinePoints, color, width, 1, { clickable: false });
                            //  map.addOverlay(polyline);
                            //  getData(stpick);
                        },
                        error: function ($xhr, textStatus) {
                            response([]);
                        }
                    });

                }

            });

            $("#qsaddr").autocomplete({
                appendTo: "body",
                source: function (request, response) {

                    var prefixText = $('input#qsaddr').val();
                    //    stcntystr = prefixText;
                    $.ajax({
                        type: "GET",
                        url: "WebService.asmx/GetSaddr",
                        data: "prefixText=" + prefixText,
                        dataType: "xml",
                        success: function (xmlres, textStatus, $xhr) {
                            myArr.length = 0;
                            $(xmlres).find("data").each(function () {
                                myArr.push($(this).find('content').text());
                            });

                            response(myArr);
                        },
                        error: function ($xhr, textStatus) {
                            response([]);
                        }
                    });


                },
                data: myArr,
                minLength: 3,
                autoFocus: true,
                select: function (event, ui) {

                    for (var i = 0; i < polylines.length; i++) {
                        map.ClearPolylineOnGoogleMap(polylines[i]);
                    }
                    polylines = [];
                    svalue = ui.item.value;
                    var bbox = map.GetBoundingBox();
                    $.ajax({
                        type: "GET",
                        url: "search.aspx",
                        data: "&skey=saddr" + "&svalue=" + svalue + "&canht=" + map.height + "&canwd=" + map.width + "&boundne=" + bbox.top + "," + bbox.right + "&boundsw=" + bbox.bottom + "," + bbox.left,
                        dataType: "xml",
                        success: function (xmlres, textStatus, $xhr) {
                            $(xmlres).find("line").each(function () {

                                var polylinepts = [];
                                     polystr = "";
                                $(this).find("point").each(function () {
                                    latitude = parseFloat($(this).attr('lat'));
                                    longitude = parseFloat($(this).attr('lng'));
                                    polylinepts.push(new google.maps.LatLng(latitude, longitude));
                                          polystr = polystr + latitude.toString() + "," + longitude.toString() + "|";
                                });


                                var lined = new google.maps.Polyline({
                                    path: polylinepts,
                                    strokeColor: '#0000ff',
                                    strokeOpacity: 1.0,
                                    strokeWeight: 3
                                });
                                map.DrawPolylineOnGoogleMap(lined);

                                polylines.push(lined);

                            });

                            var bb = {};
                            bb.left = $(xmlres).find("bbounds").attr('minlng');
                            bb.top = $(xmlres).find("bbounds").attr('maxlat');
                            bb.right = $(xmlres).find("bbounds").attr('maxlng');
                            bb.bottom = $(xmlres).find("bbounds").attr('minlat');

                            map.ZoomToBoundingBox(bb, false);
                            map.Refresh();
                            var htmltab = "<table border=1 cellspacing=0>";
                            //   $("div#dialog").append("<div><P>Test Test</P></div>"); 
                            //   $dialog.dialog({ title: clickinci });
                            $(xmlres).find('data').each(function () {
                                var nme = $(this).find('name').text();
                                var cnt = $(this).find('content').text();
                                if (nme == "JOIN_GPIN") {
                                    pcval = cnt;
                                }
                                htmltab = htmltab + "<tr><td>" + nme + "</td><td>" + cnt + "</td><tr>";
                            })
                            htmltab = htmltab + "</table>";
                            $("#intab").html("<div>" + htmltab + "</div>");

                            //   polyline = new google.maps.Polyline(polylinePoints, color, width, 1, { clickable: false });
                            //  map.addOverlay(polyline);
                            //  getData(stpick);
                        },
                        error: function ($xhr, textStatus) {
                            response([]);
                        }
                    });

                }

            });



   $("input[name='search']").bind("keypress", function (e, ui) {
                var code = (e.keyCode ? e.keyCode : e.which);
                if (code == 13) { //Enter keycode 


                    //  if (event.keyCode == 13) {
                    var result = "";
                    var address = $("input[name='search']").val();
                    var geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ 'address': address, 'region': 'us' },
                            function (results, status) {
                                if (status == google.maps.GeocoderStatus.OK) {
                                    result = results[0].geometry.location;
                                    cenx = result.lng();
                                    ceny = result.lat();

                                    //                        //                        if (map == null) {
                                    //                        //                            map = new GSCMap("-124.162620544434, 32.5765647888184, -114.597885131836, 49.3188133239746", 4326);

                                    //                        //                            // map = new GSCMap("map_canvas", "1646375.516113808,779832,1763616.358886192,865543.5625", 2264);
                                    map.SetGoogleBase(ceny, cenx, 20);
                                    map.SetZoom(17);
                                    //                        //                        }


                                    var otfs = new OTFCollection("searchpt", 4326);
                                    var items;
                                    var markerImage = new Image();
                                    markerImage.src = "images/mm_20_red.png";
                                    items = new OTFCollectionItem("test", "searchpt", cenx, ceny, markerImage, markerImage, 4326, "CENTER");

                                    otfs.AddItem(items);
                                    map.AddOtfCollection(otfs);
                                    map.SetCenter(cenx, ceny);

                                    map.Refresh();

                                } else {
                                    alert("Unable to find address: " + status);
                                }
                              var htmltab = "<table border=1 cellspacing=0>";
                            //   $("div#dialog").append("<div><P>Test Test</P></div>"); 
                            //   $dialog.dialog({ title: clickinci });
                           // $(xmlres).find('data').each(function () {
                           //     var nme = $(this).find('name').text();
                           //     var cnt = $(this).find('content').text();

                           //     htmltab = htmltab + "<tr><td>" + nme + "</td><td>" + cnt + "</td><tr>";
                            //  })
                            htmltab = htmltab + "<tr><td>" + "  " + "</td><td>" + "   " + "</td><tr>";
                            htmltab = htmltab + "</table>";
                            $("#intab").html("<div>" + htmltab + "</div>");
                            ///////////////
                            pcval = "";

                            });
                }

            });
        
            $("#qaddr").autocomplete({
                appendTo: "body",
                source: function (request, response) {

                    var prefixText = $('input#qaddr').val();
                    //    stcntystr = prefixText;
                    $.ajax({
                        type: "GET",
                        url: "WebService.asmx/GetAddr",
                        data: "prefixText=" + prefixText,
                        dataType: "xml",
                        success: function (xmlres, textStatus, $xhr) {
                            myArr.length = 0;
                            $(xmlres).find("data").each(function () {
                                myArr.push($(this).find('content').text());
                            });

                            response(myArr);
                        },
                        error: function ($xhr, textStatus) {
                            response([]);
                        }
                    });


                },
                data: myArr,
                minLength: 4,
                autoFocus: true,
                select: function (event, ui) {

                    for (var i = 0; i < polylines.length; i++) {
                        map.ClearPolylineOnGoogleMap(polylines[i]);
                    }

                    svalue = ui.item.value;
                    var bbox = map.GetBoundingBox();
                    $.ajax({
                        type: "GET",
                        url: "search.aspx",
                        data: "&skey=addr" + "&svalue=" + svalue + "&canht=" + map.height + "&canwd=" + map.width + "&boundne=" + bbox.top + "," + bbox.right + "&boundsw=" + bbox.bottom + "," + bbox.left,
                        dataType: "xml",
                        success: function (xmlres, textStatus, $xhr) {
                            $(xmlres).find("point").each(function () {
                                ceny = parseFloat($(this).attr('lat'));
                                cenx = parseFloat($(this).attr('lng'));
                                var otfs = new OTFCollection("searchpt", 4326);
                                var items;
                                var markerImage = new Image();
                                markerImage.src = "images/mm_20_red.png";
                                items = new OTFCollectionItem("test", "searchpt", cenx, ceny, markerImage, markerImage, 4326, "CENTER");

                                otfs.AddItem(items);
                                map.AddOtfCollection(otfs);
                                map.SetCenter(cenx, ceny);
                                map.SetZoom(16);
                                map.Refresh();
                            });
                           var htmltab = "<table border=1 cellspacing=0>";
                            //   $("div#dialog").append("<div><P>Test Test</P></div>"); 
                            //   $dialog.dialog({ title: clickinci });
                           // $(xmlres).find('data').each(function () {
                           //     var nme = $(this).find('name').text();
                           //     var cnt = $(this).find('content').text();

                           //     htmltab = htmltab + "<tr><td>" + nme + "</td><td>" + cnt + "</td><tr>";
                            //  })
                            htmltab = htmltab + "<tr><td>" + "  " + "</td><td>" + "   " + "</td><tr>";
                            htmltab = htmltab + "</table>";
                            $("#intab").html("<div>" + htmltab + "</div>");
                            ///////////////
                            pcval = "";

                        },
                        error: function ($xhr, textStatus) {
                            response([]);
                        }
                    });
                    $(this).val(''); return false;
                }

            });

            $("#grid1").igGrid({
                autoGenerateColumns: false,
                columns: [
         { headerText: "pin", key: "pin", width: "80px" },
                { headerText: "parcel_id", key: "parcel_id", width: "80px" },
                 { headerText: "owner1", key: "owner1", width: "80px" },
                { headerText: "total_acre", key: "total_acre", width: "80px" },
                { headerText: "prop_addr", key: "prop_addr", width: "80px" },
                { headerText: "bk_pg", key: "bk_pg", width: "80px" },
                { headerText: "land_val", key: "land_val", width: "80px" },
                { headerText: "bldg_val", key: "bldg_val", width: "80px" },
                { headerText: "total_val", key: "total_val", width: "80px" },
                { headerText: "sale_date", key: "sale_date", width: "80px" },
                { headerText: "sale_price", key: "sale_price", width: "80px" },
                { headerText: "mail_addr1", key: "mail_addr1", width: "80px" },
                { headerText: "mail_addr2", key: "mail_addr2", width: "80px" },
                { headerText: "city", key: "city", width: "80px" },
                { headerText: "zip_code", key: "zip_code", width: "80px" }





    ],
                //   dataSource: "test.xml",
                //   responseDataKey: 'data',
                //   width: "500px",
                //                features: [{                     
                //                name: "Paging",                     
                //                type: "local",                     
                //                pageSize: 50                 
                //                }], 
                //  width: "100%",
                height: "400px"
            });

            //          $("input[name='dbtn']").live("click", function (event, ui) {
            //             // if (event.keyCode == 13) {
            //                  var res = "";
            //                  var sfor = $("input[name='dbtn']").val();
            //                  getData(sfor);
            //             // }
            //          });
        });

      

        $(function () {
        
                $("#gaccord").accordion({ collapsible: true, active: 0});
            $("#saccord").accordion({ collapsible: true, active: 0});
                $("#streetaccord").accordion({ collapsible: true, active: false});
            $("#accordion").accordion({
                collapsible: true,
                active: false
            })
            $("#datadd").accordion({ collapsible: true, active: false });
            $("#toolsbut").accordion({ collapsible: true, active: false });
            $("#saveasb").accordion({ collapsible: true, active: false });   
        });

      //  $(function () { $("#dialog1").dialog(); });

     
       

      

    </script>


</head>
<body>

<!-- manually attach allowOverflow method to pane -->
<div class="ui-layout-north" onmouseover="myLayout.allowOverflow('north')" onmouseout="myLayout.resetOverflow(this)">
        <p><a href="http://www.pittsylvaniacountyva.gov/">Pittsylvania County</a></p>
  
</div>

<!-- allowOverflow auto-attached by option: west__showOverflowOnHover = true -->

   


<div class="ui-layout-west">
 <div id="gaccord">
  <h3><a href="#">Address or Location Search</a></h3>
    <div>
        <div class="ui-widget"> 
                   <label for="qsstate">Google: </label>
                     <br /><label for="qsstate">St# StreetName, City, St </label>
                     <br><label for="qsstate">OR: latitude, -longitude </label>
                <br><label for="qsstate">e.g.: 36.827699, -79.398537 </label>
             <input type="text" name="search" id="search-basic" value=""   />
            </div>  
 <div class="ui-widget"> 
  <br /><label for="qaddr">County Address Table: </label>
    <br /><label for="qaddr">100 MAIN ST</label>
    <br /><input type="text" id="qaddr"/> 
  </div>   
    </div>
  </div>  
   
  <div id="saccord">
  <h3><a href="#">Start Parcel Table Searches Here</a></h3>
    <div>
    <div class="ui-widget">    
  <label>Click once within parcel</label>
     <label>bounds for info or search below.</label>
      <label>Valid choices will appear</label>
 <label>as you type your search string.</label>
<label>Select one from the dropdown.</label>
      <br />
  
  
   
            </div>
        <div class="ui-widget">
     <br /><label for="qowner">Owner: </label>
    <br /><label for="qowner">Example: LAST, FIRST </label>
    <br /><input type="text" id="qowner"/>
    </div>
            <div class="ui-widget">
    <label for="qpin">GPIN: </label>
    <br /><label for="qpin">Ex: 1234-56-7890 </label>
    <input type="text" id="qpin" />
    </div>   
     <div class="ui-widget">
    <label for="qparid">Account Number: </label>
    <br /><label for="qparid">Ex: 12345-12-12-7890-A</label>
    <input type="text" id="qparid" />
    </div>
      <div class="ui-widget">
    <label for="qsaddr">Site Addr: </label>
    <br /><label for="qsaddr">Ex: 597 SAGO RD</label>
    <input type="text" id="qsaddr" />
    </div>
          <div class="ui-widget">
    <label for="qdbpg">Deed Book/Page: </label>
    <br /><label for="qdbpg">Example: DB1234/567 </label>
    <br /><input type="text" id="qdbpg"/>
    </div>
    </div>
  </div>  
   
 <div id="streetaccord">  
  <h3><a href="#">Streets</a></h3>
    <div>    
    <input type="checkbox" id="ocsc" name="sc" /><label>&nbsp;Pittsylvania County Streets</label><span class="ui-li-count"></span><br />
     <input type="checkbox" id="goos" name="gsc" /><label>&nbsp;Google Streets</label><span class="ui-li-count"></span><br />            
   </div>
  </div>

<div id="accordion">  
 </div>  
 <div id="datadd">  
  <h3><a href="#">Instructions/Links</a></h3>
    <div class="ui-widget">  
   <button type="button" class="ui-button ui-button-text-only ui-widget ui-state-default ui-corner-all" id="showdd">
            <span class="ui-button-text">Instruction Dialog</span>
            </button>
   </div>
  </div>
  <div id="toolsbut">  
  <h3><a href="#">Measure Tool</a></h3>
    <div class="ui-widget">  
   <button type="button" class="ui-button ui-button-text-only ui-widget ui-state-default ui-corner-all" id="rbut">
            <span class="ui-button-text">On</span>
            </button>
            <button type="button" class="ui-button ui-button-text-only ui-widget ui-state-default ui-corner-all" id="rbut2">
            <span class="ui-button-text">Clear</span></button><br />
            <span>Length: </span>  <span id="span-length">0</span><br />
            <span>Area: </span>   <span id="span-area">0</span>
   </div>
  </div>
<div id="saveasb">  
  <h3><a href="#">Save Map to image</a></h3>
    <div class="ui-widget">   
           <label>Choose height, width in pixels</label>
     <label> (max 640). Click SaveImage.</label>
        <label>Right click on image in pop up tab</label>
            <label>and use save picture as</label>
            <br />
       
    <label for="saht">Height</label>    
    <input type="text" id="saht" class="htwd" />     
    <label for="sawd">Width</label>    
    <input type="text" id="sawd" class="htwd" />
    <br />
    <div class="ui-widget" style="text-align: center; padding-top: 3px;">   
     <button type="button" class="ui-button ui-button-text-only ui-widget ui-state-default ui-corner-all" id="simage">
            <span class="ui-button-text">SaveImage</span>
            </button>
            </div>
             </div>
  </div>
</div>

<div class="ui-layout-south">
     
     
 
  
</div>

<div class="ui-layout-east">
    <div><button type='button' class='ui-button ui-button-text-only ui-widget ui-state-default ui-corner-all' id='pfor'>
                                 <span class='ui-button-text-only'>Print Format</span></button> 
                                   <button type='button' class='ui-button ui-button-text-only ui-widget ui-state-default ui-corner-all' id='pcard'>
                                 <span class='ui-button-text-only'>Property Card</span></button></div>
 
     <div id="intab" class='parClass'>
     </div>
    <!-- attach allowOverflow method to this specific element -->
    

    


</div>

 

 
        <div id="mycenter" class="ui-layout-center" style="overflow: hidden; width:100%; height:100%; margin:0px !important; position:relative;">
         
    <div id="map_canvas" style="overflow: hidden; width:100%; height:100%; margin:0px !important; position:relative;"></div>
        </div>
         
  
  <div id="dialog" title="Instructions/Links">
<div>
     <p>Welcome to the web-based map server for Pittsylvania county.
Property information is as of August 2012.</p> 

<p><font COLOR="#6600cc"><B>Parcel Search Notices</B></font>
&nbsp;&nbsp; Not all mapped parcels will have associated real estate information. Please see <a href="searchnotice.htm" target="_blank">this notice</a> regarding parent/child parcels.</p>
<p>Please see <a href="RealEstateDataCodes.htm" target="_blank";>this link</a> for the definition of some of the column names which you
will see in a parcel data display.</P> 
<p>The following tables may be used for translating codes found on the Property Record Card.</p>
<p><a href="Residential Abbreviations and Codes.htm" target="_blank";>Residential Abbreviations and Codes</a></p>
<p><a href="Land Codes.htm" target="_blank";>Land Codes</a></p>
<p><a href="Extras and Inclusions Codes.htm" target="_blank";>Extras and Inclusions Codes</a></p>
<p><a href="Additional Abbreviations and Codes.htm" target="_blank";>Additional Abbreviations and Codes</a></p>
<p><a href="Commercial Abbreviations and Codes.htm" target="_blank";>Commercial Abbreviations and Codes</a></p>
<p>&nbsp;</p>
<p><font COLOR="#6600cc"><B>Public Safety Location Information</B></font>
<p><a href="Pittsylvania County EMS and Fire Stations List.htm" target="_blank";>Pittsylvania County EMS and Fire Stations List</a></p>
<p>&nbsp;</p>
<b><p><font COLOR="#6600CC"><a name="prop">How to do a Property Search</a></b></font> </p>

<p>Click on the + for "Quick Search" at the left of the screen and several search options will be displayed.
Choose only one option according to the information you have, i.e. Name or Parcel ID. Matches will be shown after you type in the first 4 characters.
You should see a match if your choice is in the database. Select the match by clicking on your choice in the dropdown. 
It is important to enter the name in the format the database uses. E.G. last name
followed by a comma then a single space followed by the first name or portion thereof. For a name search, if multiple names are found a list will be 
presented for you to choose from. It will bring up the tax info for the name you pick and then draw the associated
parcel map with a red outline. 
<p>The Property Record Card may be shown by clicking . Use the Print option from the browser File menu to print the property card.</p>
<p>To print the map with property info click   to get a popup printable format. Use the Print option from the browser File menu to print the popup page.</p>
<br />
<b><p><font COLOR="#6600CC"><a name="prop">How to get Parcel Info </a></b></font> </p>
 
<p>By default the map is set to "Info Mode". You can set this under "Map Tools" as well. When the map is in
Info mode and the Parcel layer is displayed you can click within a parcel boundary and its database information will be 
displayed in the right panel.</p>


<p>&nbsp;</p>
<p>&nbsp;</p>
<b><font color="#6600CC"><p><a name="pdfinfo">Tax and Zoning Map Grid Sheet PDF Files</a></b></font>
<p>To view property sheets in a pdf format:</p>
<ol>
<li>Check the desired grid layer under the Map Grids Section of the available Data Layers.
<li>Uncheck any other layers you may have turned on.
<li>Click within the grid square you are interested in. 
<li>The link will appear underlined in the information grid that appears in the left portion of the screen. 
<li>When you click the link a pop-up pdf will appear. This can be printed at 11 x 8.5 by choosing "Page Scaling: Fit to paper" under the print option of your Adobe PDF Viewer. These sheets are large format images at 36" x 30".
</ol>
<P>The following pdf files may be helpful when looking at the map sheets for 100, 200 Scale Tax Map Grids: 
<br/><a href="Pittsylvania_County_Tax_Map_Grids_Index_Map_Legend.pdf" target="_blank";>Tax Map Grids Index Map Legend</a>
<br/><a href="Pittsylvania_County_Tax_Map_Grids_Index_Map.pdf" target="_blank";>Tax Map Grids Index Map</a>
<br/><a href="Pittsylvania_County_Tax_Map_Block_Grid_Numbers_Index_Map.pdf" target="_blank";>Tax Map Block Grid Numbers Index</a>
<br/><a href="Pittsylvania_County_400_Scale_Tax_Map_Grids_Transition_Map.pdf" target="_blank";>400 Scale Tax Map Grids Transition Map</a>
<br/><a href="Pittsylvania_County_400_Scale_Tax_Map_Grids_Index_Map.pdf" target="_blank";>400 Scale Tax Map Index</a>
<br/><a href="Pittsylvania_County_400_Scale_Tax_Map_Grids_Clamp_Index_Map.pdf" target="_blank";>400 Scale Tax Map Grids Clamp Index</a></p>
<p>The following pdf files may be helpful when looking at the map sheets for 100, 200 Scale Zoning Map Grids: 
<br/><a href="Pittsylvania_County_Zoning_Map_Grids_Index_Map_Legend.pdf" target="_blank";>Zoning Map Grids Index Map Legend</a>
<br/><a href="Pittsylvania_County_Zoning_Map_Grids_Index_Map.pdf" target="_blank";>Zoning Map Grids Index Map</a>
<br/><a href="Pittsylvania_County_Zoning_Map_Block_Grid_Numbers_Index_Map.pdf" target="_blank";>Zoning Map Block Grid Numbers Index</a>
<br/><a href="Pittsylvania_County_400_Scale_Zoning_Map_Grids_Transition_Map.pdf" target="_blank";>400 Scale Zoning Map Grids Transition Map</a>
<br/><a href="Pittsylvania_County_400_Scale_Zoning_Map_Grids_Index_Map.pdf" target="_blank";>400 Scale Zoning Map Index</a>
<br/><a href="Pittsylvania_County_400_Scale_Zoning_Map_Grids_Clamp_Index_Map.pdf" target="_blank";>400 Scale Zoning Map Grids Clamp Index</a></p> 
</p> 
<p></p>


<p><b>Disclaimer:</b> 
This map data is prepared from the inventory of real property found
within this jurisdiction, and is compiled from recorded deeds,
plats and other public records and data.  Users of any maps generated on this site 
are hereby notified that the aformentioned public primary information 
sources should be consulted for verification of the
information contained on any maps.  The county nor Sungard assumes
any legal responsibility for the information contained on these maps.
</p>
    

</div>
</div>
 
   
<script type="text/javascript">
    function test() {



        $.get('layrlist.xml', function (data) {

            var acc = $('#accordion');
            //you need to destroy the accordion first
            acc.accordion("destroy");
            acc.empty();
            var html = '<div>';

            var t = 0;

            $(data).find('theme').each(function () {

                var $theme = $(this);

                //  themevars[t] = $theme.find('datecol').attr("name");
                themevars[t] = $theme.attr("dateColumn");
                themecols[t] = $theme.attr("dataCol");
                themetabs[t] = $theme.attr("tableName");
                html += '<h3><a href="#">' + $theme.attr("name") + '</a></h3><div>';
                //<a><img style="float:right;margin:3px 3px 3px 3px;" src="images/tools.png" height="15" width="15"/></a>
                //   html += '<div><input class="ui-state-default ui-corner-all" value="Start Date" id="datestart' + t + '" type="text"  /><br><input class="ui-state-default ui-corner-all" value="End Date" id="dateend' + t + '" type="text" /></div><div><br></div>';

                $theme.find('queryLayer').each(function () {
                    var $layr = $(this);
                    var ckstr = '\x27' + $layr.attr("filterName") + '\x27';
                    html += ' <input type="checkbox" id="' + $layr.attr("filterName") + '" name="' + t + '" + " title="' + $layr.attr("iconName") + '" />';
                    if ($layr.attr("iconName") != "") {
                        html += ' <img src="' + $layr.attr("iconName") + '" height="12" width="12" onclick="javascript:check(' + ckstr + ');" />';
                    }
                    html += '<label class="mylabel">&nbsp;' + $layr.attr("filterName") + '</label><span class="ui-li-count"></span><br />';
                    if ($layr.attr("filterName") == "Zip Code Areas") {
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legzaxt.png" height=12 width=15 hspace=2 border=no></a>24054 Axton</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzbla.png" height=12 width=15 hspace=2 border=no></a>24527 Blairs</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzcal.png" height=12 width=15 hspace=2 border=no></a>24530 Callands</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzcas.png" height=12 width=15 hspace=2 border=no></a>24069 Cascade</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzcha.png" height=12 width=15 hspace=2 border=no></a>24531 Chatham</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzdan.png" height=12 width=15 hspace=2 border=no></a>24540 24541 24543</DIV><DIV STYLE="text-indent: 20pt;">Danville</DIV>';
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legzdf.png" height=12 width=15 hspace=2 border=no></a>24549 Dry Fork</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzgre.png" height=12 width=15 hspace=2 border=no></a>24557 Gretna</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzhur.png" height=12 width=15 hspace=2 border=no></a>24563 Hurt</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzjav.png" height=12 width=15 hspace=2 border=no></a>24565 Java</DIV>';  
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legzkee.png" height=12 width=15 hspace=2 border=no></a>24566 Keeling</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzli.png" height=12 width=15 hspace=2 border=no></a>24569 Long Island</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzpen.png" height=12 width=15 hspace=2 border=no></a>24137 Penhook</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzpit.png" height=12 width=15 hspace=2 border=no></a>24139 Pittsville</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzrin.png" height=12 width=15 hspace=2 border=no></a>24586 Ringgold</DIV>';
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legzsl.png" height=12 width=15 hspace=2 border=no></a>24161 Sandy Level</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzsut.png" height=12 width=15 hspace=2 border=no></a>24594 Sutherlin</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzvh.png" height=12 width=15 hspace=2 border=no></a>24597 Vernon Hill</DIV>';
}
                    if ($layr.attr("filterName") == "Zoning") {
                       html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legzwhite.png" height=12 width=15 hspace=2 border=no></a>A-1 Agricultural</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzgreen.png" height=12 width=15 hspace=2 border=no></a>RE Residential Estates</DIV>';
 html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legzyel.png" height=12 width=15 hspace=2 border=no></a>R-1 Residential Suburban Subdivision</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzorange.png" height=12 width=15 hspace=2 border=no></a>RC-1 Residential Combined Subdivision</div>';
 html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legzrmf.png" height=12 width=15 hspace=2 border=no></a>RMF Residential Multi-Family</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzrpd2.png" height=12 width=15 hspace=2 border=no></a>RPD Residential Planned</DIV>';
 html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legzmhp.png" height=12 width=15 hspace=2 border=no></a>MHP Residential Manufactured Housing</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzb1.png" height=12 width=15 hspace=2 border=no></a>B-1 Business Limited</DIV>';
 html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legzpur.png" height=12 width=15 hspace=2 border=no></a>B-2 Business General</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzm1.png" height=12 width=15 hspace=2 border=no></a>M-1 Industrial Light</div>';
 html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legzred.png" height=12 width=15 hspace=2 border=no></a>M-2 Industrial Heavy</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzhur.png" height=12 width=15 hspace=2 border=no></a>C-1 Conservation District</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legztz2.png" height=12 width=15 hspace=2 border=no></a>TZ Town Zoning</DIV>';
 html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legzdz.png" height=12 width=15 hspace=2 border=no></a>Double Zoned Parcels</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzuk.png" height=12 width=15 hspace=2 border=no></a>Unknown</div>';
                    } 
                    if ($layr.attr("filterName") == "Fire Station Districts") {
                     html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legdan.png" height=12 width=15 hspace=2 border=no></a>Danville</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta17.png" height=12 width=15 hspace=2 border=no></a>Station 17</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta21.png" height=12 width=15 hspace=2 border=no></a>Station 21</DIV>';
 html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta22.png" height=12 width=15 hspace=2 border=no></a>Station 22</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta23.png" height=12 width=15 hspace=2 border=no></a>Station 23</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta24.png" height=12 width=15 hspace=2 border=no></a>Station 24</DIV>';
 html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta25.png" height=12 width=15 hspace=2 border=no></a>Station 25</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta26.png" height=12 width=15 hspace=2 border=no></a>Station 26</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta27.png" height=12 width=15 hspace=2 border=no></a>Station 27</DIV>';
 html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta29.png" height=12 width=15 hspace=2 border=no></a>Station 29</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta30.png" height=12 width=15 hspace=2 border=no></a>Station 30</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta31.png" height=12 width=15 hspace=2 border=no></a>Station 31</DIV>';
 html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta32.png" height=12 width=15 hspace=2 border=no></a>Station 32</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta33.png" height=12 width=15 hspace=2 border=no></a>Station 33</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta34.png" height=12 width=15 hspace=2 border=no></a>Station 34</DIV>';
 html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta35.png" height=12 width=15 hspace=2 border=no></a>Station 35</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta36.png" height=12 width=15 hspace=2 border=no></a>Station 36</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta37.png" height=12 width=15 hspace=2 border=no></a>Station 37</DIV>';
 html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta38.png" height=12 width=15 hspace=2 border=no></a>Station 38</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta39.png" height=12 width=15 hspace=2 border=no></a>Station 39</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta40.png" height=12 width=15 hspace=2 border=no></a>Station 40</DIV>';
 html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legsta42.png" height=12 width=15 hspace=2 border=no></a>Station 42</DIV>';
                 
                    }
                    if ($layr.attr("filterName") == "EMS Station Districts") {
                     html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legemsyel.png" height=12 width=15 hspace=2 border=no></a>Squad 10</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/legemsdkrose.png" height=12 width=15 hspace=2 border=no></a>Squad 12</DIV>';
html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legemsdkblue.png" height=12 width=15 hspace=2 border=no></a>Squad 13</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legemsltgreen.png" height=12 width=15 hspace=2 border=no></a>Squad 14</DIV>';
html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legemsltpink.png" height=12 width=15 hspace=2 border=no></a>Squad 20</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legemsltolive.png" height=12 width=15 hspace=2 border=no></a>Squad 23</DIV>';
html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legemsltaqua.png" height=12 width=15 hspace=2 border=no></a>Squad 25</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legemstanger.png" height=12 width=15 hspace=2 border=no></a>Squad 27</DIV>';
html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legemsbrown.png" height=12 width=15 hspace=2 border=no></a>Squad 33</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legemsltblue.png" height=12 width=15 hspace=2 border=no></a>Squad 34</DIV>';
html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legemsgryel.png" height=12 width=15 hspace=2 border=no></a>Squad 35</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legemsmuddyrose.png" height=12 width=15 hspace=2 border=no></a>Squad 36</DIV>';
html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legemspur.png" height=12 width=15 hspace=2 border=no></a>Squad 37</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legemsgrey.png" height=12 width=15 hspace=2 border=no></a>Squad 50</DIV>';
                    
                     }
                    if ($layr.attr("filterName") == "Neighborhood Watch Areas") {
                     html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legnwyel.png" height=12 width=15 hspace=2 border=no></a>BMNW</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legnworan.png" height=12 width=15 hspace=2 border=no></a>MFNW</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legnwgryel.png" height=12 width=15 hspace=2 border=no></a>MTNW</DIV>';
                     html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legnwgblue.png" height=12 width=15 hspace=2 border=no></a>RGNW</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/legnwltpink.png" height=12 width=15 hspace=2 border=no></a>RSNW</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legnwpur.png" height=12 width=15 hspace=2 border=no></a>SGNW</DIV>';
                     html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legnwdkpink.png" height=12 width=15 hspace=2 border=no></a>BCNW</DIV>';
                    }
                    if ($layr.attr("filterName") == "Elementary School Zones") {
                    html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legelyel.png" height=12 width=15 hspace=2 border=no></a>Brosville</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/legepinklt.png" height=12 width=15 hspace=2 border=no></a>Chatham</DIV>';
                html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legepinkmed.png" height=12 width=15 hspace=2 border=no></a>Gretna</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legeltbrwn.png" height=12 width=15 hspace=2 border=no></a>John L. Hurt Jr.</DIV>';
               html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legepur.png" height=12 width=15 hspace=2 border=no></a>Kentuck</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legegreen.png" height=12 width=15 hspace=2 border=no></a>Mt Airy</DIV>';
                html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legepinkdk.png" height=12 width=15 hspace=2 border=no></a>Southside</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legeoran.png" height=12 width=15 hspace=2 border=no></a>Stony Mill</DIV>';
              html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legedkteal.png" height=12 width=15 hspace=2 border=no></a>Twin Springs</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legeltteal.png" height=12 width=15 hspace=2 border=no></a>Union Hall</DIV>';
                    }
                 if ($layr.attr("filterName") == "Middle School Zones") {
                  html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legregpink.png" height=12 width=15 hspace=2 border=no></a>Chatham</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legregpur.png" height=12 width=15 hspace=2 border=no></a>Dan River</DIV>';
                  html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legresyel.png" height=12 width=15 hspace=2 border=no></a>Gretna </DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legreggreen.png" height=12 width=15 hspace=2 border=no></a>Tunstall</div>';
                 }
                   if ($layr.attr("filterName") == "High School Zones") {
                    html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/leghspink.png" height=12 width=15 hspace=2 border=no></a>Chatham</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/leghsblue.png" height=12 width=15 hspace=2 border=no></a>Dan River</DIV>';
                    html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/leghsyel.png" height=12 width=15 hspace=2 border=no></a>Gretna </DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/leghsgreen.png" height=12 width=15 hspace=2 border=no></a>Tunstall</div>';
                    }
                   if ($layr.attr("filterName") == "Telco Areas") {
                    html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legregpur.png" height=12 width=15 hspace=2 border=no></a>Verizon</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legreggreen.png" height=12 width=15 hspace=2 border=no></a>Sprint</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legregorange.png" height=12 width=15 hspace=2 border=no></a>Peoples Mutual</DIV>';
                   }
                   if ($layr.attr("filterName") == "Election Districts") {
                   html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legedgreen.png" height=12 width=15 hspace=2 border=no></a>Banister</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legedgrey.png" height=12 width=15 hspace=2 border=no></a>Callands-Gretna</DIV>';
                   html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legedlyel.png" height=12 width=15 hspace=2 border=no></a>Chatham-Blairs</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legedltpink.png" height=12 width=15 hspace=2 border=no></a>Dan River</div>';
                   html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legedorange.png" height=12 width=15 hspace=2 border=no></a>Staunton River</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legedaqua.png" height=12 width=15 hspace=2 border=no></a>Tunstall</DIV>';
                   html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legedmedpink.png" height=12 width=15 hspace=2 border=no></a>Westover</DIV>';
                    }
                     if ($layr.attr("filterName") == "Polling Precincts") {
                    html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legbhall.png" height=12 width=15 hspace=2 border=no></a>Bachelors Hall</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legbear.png" height=12 width=15 hspace=2 border=no></a>Bearskin</DIV>';
                    html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legbros.png" height=12 width=15 hspace=2 border=no></a>Brosville</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legcall.png" height=12 width=15 hspace=2 border=no></a>Callands</DIV>';
                       html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legcentral.png" height=12 width=15 hspace=2 border=no></a>Central</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legchatham.png" height=12 width=15 hspace=2 border=no></a>Chatham</DIV>';
                    html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legclimax.png" height=12 width=15 hspace=2 border=no></a>Climax</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legdryfork.png" height=12 width=15 hspace=2 border=no></a>Dry Fork</DIV>';
                     html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legeblair.png" height=12 width=15 hspace=2 border=no></a>East Blairs</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legegretna.png" height=12 width=15 hspace=2 border=no></a>East Gretna</DIV>';
                     html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legferry.png" height=12 width=15 hspace=2 border=no></a>Ferry Road</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/leggretna.png" height=12 width=15 hspace=2 border=no></a>Gretna</DIV>';
                   html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/leghurt.png" height=12 width=15 hspace=2 border=no></a>Hurt</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legkeeling.png" height=12 width=15 hspace=2 border=no></a>Keeling</div>';
                       html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legkentuck.png" height=12 width=15 hspace=2 border=no></a>Kentuck</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legmot.png" height=12 width=15 hspace=2 border=no></a>Motley Sycamore</DIV>';
                     html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legmta.png" height=12 width=15 hspace=2 border=no></a>Mt Airy</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legmtc.png" height=12 width=15 hspace=2 border=no></a>Mt Cross</DIV>';
                    html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legmth.png" height=12 width=15 hspace=2 border=no></a>Mt Herman</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legrenan.png" height=12 width=15 hspace=2 border=no></a>Renan</DIV>';
                    html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legrice.png" height=12 width=15 hspace=2 border=no></a>Riceville</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legring.png" height=12 width=15 hspace=2 border=no></a>Ringgold</DIV>';
                       html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legsandy.png" height=12 width=15 hspace=2 border=no></a>Sandy Level</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legstony.png" height=12 width=15 hspace=2 border=no></a>Stony Mill</DIV>';
                    html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legswan.png" height=12 width=15 hspace=2 border=no></a>Swansonville</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legtun.png" height=12 width=15 hspace=2 border=no></a>Tunstall</DIV>';
                    html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legtwin.png" height=12 width=15 hspace=2 border=no></a>Twin Springs</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legwblair.png" height=12 width=15 hspace=2 border=no></a>West Blairs</DIV>';
                   html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legwhit.png" height=12 width=15 hspace=2 border=no></a>Whitmell</DIV>';
                    }
                    if ($layr.attr("filterName") == "Electric Service Areas") {
                      html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legresyel.png" height=12 width=15 hspace=2 border=no></a>AEP</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legresblue.png" height=12 width=15 hspace=2 border=no></a>Dominion Va</DIV>';
                      html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legreslime.png" height=12 width=15 hspace=2 border=no></a>American</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legrespink.png" height=12 width=15 hspace=2 border=no></a>Danville Power and Light</div>';
                      html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legresgreen.png" height=12 width=15 hspace=2 border=no></a>Mecklenburg</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/legresbrwn.png" height=12 width=15 hspace=2 border=no></a>Southside</div>';
                    } 
                    if ($layr.attr("filterName") == "Shoreline Classifications") {
                       html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legscgr.png" height=12 width=15 hspace=2 border=no></a>Public Use</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsclow.png" height=12 width=15 hspace=2 border=no></a>Low Density Use</DIV>';
                       html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legscim.png" height=12 width=15 hspace=2 border=no></a>Impact Minimization</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legsccon.png" height=12 width=15 hspace=2 border=no></a>Conservation-Environmental</div>';
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legschdc.png" height=12 width=15 hspace=2 border=no></a>High Density Commercial</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legschdm.png" height=12 width=15 hspace=2 border=no></a>High Density Multi Use</DIV>';   
                    }
                    if ($layr.attr("filterName") == "Megasites") {
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legrbkblue.png" height=12 width=15 hspace=2 border=no></a>North Chatham</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legrbkorange.png" height=12 width=15 hspace=2 border=no></a>South Chatham</DIV>';
                         html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legenterprise.png" height=12 width=15 hspace=2 border=no></a>Blair</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legiskey.png" height=12 width=15 hspace=2 border=no></a>Berry Hill Road</DIV>';
                     } 
                    if ($layr.attr("filterName") == "Industrial Sites") {
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legzcal.png" height=12 width=15 hspace=2 border=no></a>Berry Hill Industrial Park</div>';
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legenterprise.png" height=12 width=15 hspace=2 border=no></a>Brosville Industrial Park</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/legiscanecreek.png" height=12 width=15 hspace=2 border=no></a>Cane Creek Centre Regional Park</DIV>';
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legiscascade.png" height=12 width=15 hspace=2 border=no></a>Cascade Site</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legischatnorth.png" height=12 width=15 hspace=2 border=no></a>Chatham North Industrial Park</DIV>';
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legischatst.png" height=12 width=15 hspace=2 border=no></a>Chatham South Industrial Park</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legischerry.png" height=12 width=15 hspace=2 border=no></a>Cherrystone Industrial Park</DIV>';
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legiscompton.png" height=12 width=15 hspace=2 border=no></a>Compton Site</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legiseastbowles.png" height=12 width=15 hspace=2 border=no></a>East Bowles Industrial Park</DIV>';
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legisgreta.png" height=12 width=15 hspace=2 border=no></a>Gretna Industrial Park</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legiskey.png" height=12 width=15 hspace=2 border=no></a>Key Industrial Park</DIV>';
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legisngretna1.png" height=12 width=15 hspace=2 border=no></a>North Gretna site</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legisringeast.png" height=12 width=15 hspace=2 border=no></a>Ringgold East Industrial Park</DIV>';
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legisringwest.png" height=12 width=15 hspace=2 border=no></a>Ringgold West Industrial Park</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legistw.png" height=12 width=15 hspace=2 border=no></a>Thompson and Wyatt</DIV>';
                    }
                    if ($layr.attr("filterName") == "Flood Zones 2010") {
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legfa.png" height=12 width=15 hspace=2 border=no></a>A</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legfae.png" height=12 width=15 hspace=2 border=no></a>AE</DIV>';
                        html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legzwhite.png" height=12 width=15 hspace=2 border=no></a>X</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legfxf.png" height=12 width=15 hspace=2 border=no></a>0.2 PCT Annual Chance Flood Hazard</div>';      
                    } 
                    if ($layr.attr("filterName") == "Future Land Use Areas") {
                         html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legbhall.png" height=12 width=15 hspace=2 border=no></a>Commercial</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/leggretna.png" height=12 width=15 hspace=2 border=no></a>Conservation</DIV>';
                         html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legwblair.png" height=12 width=15 hspace=2 border=no></a>Industrial</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legresyel.png" height=12 width=15 hspace=2 border=no></a>Medium to High Density Residential</div>';
                         html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legdryfork.png" height=12 width=15 hspace=2 border=no></a>Mixed Commerical Industrial</div>';
                    } 
                    if ($layr.attr("filterName") == "Growth Node Areas") {
                         html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/leghsgreen.png" height=12 width=15 hspace=2 border=no></a>Blairs Growth Node Area</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legrosy.png" height=12 width=15 hspace=2 border=no></a>Brosville Growth Node Area</DIV>';
                         html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/leggreenaqua.png" height=12 width=15 hspace=2 border=no></a>Chatham Growth Node Area</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legtcrgreen.png" height=12 width=15 hspace=2 border=no></a>Gretna Growth Node Area</div>';
                         html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legburntorange.png" height=12 width=15 hspace=2 border=no></a>Hurt Growth Node Area</div><DIV STYLE="text-indent: 3pt;"><a><img src="images/leglilac.png" height=12 width=15 hspace=2 border=no></a>Kentuck Growth Node Area</div>';
                         html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legbrightpur.png" height=12 width=15 hspace=2 border=no></a>Leesville Lake Shore Growth Node Area</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzcha.png" height=12 width=15 hspace=2 border=no></a>Mount Hermon Mount Cross Growth Node Area</DIV>';
                         html += '<DIV STYLE="text-indent: 3pt;"><a><img src="images/legzjav.png" height=12 width=15 hspace=2 border=no></a>Ringgold Growth Node Area</DIV><DIV STYLE="text-indent: 3pt;"><a><img src="images/legzkee.png" height=12 width=15 hspace=2 border=no></a>Smith Mountain Lake Growth Node Area</div>';
                    }  
                });
                html += '</div>';

                t++;

            });
            html += '</div>';

            acc.append($(html));
            //you need to re-make the accordion
            //  acc.accordion({ header: "h3" });
            acc.accordion({ header: "h3",
                collapsible: true,
                autoHeight: false,
                active: false

            });

            $('#Parcels').prop('checked', true);
            $('#Parcels').button("refresh");
    $("[id='goos']").prop('checked', true);
            $("[id='goos']").button("refresh");
         //   $('#Street_Centerlines').prop('checked', true);
          //  $('#Street_Centerlines').button("refresh");

        });

    }




    var map = null;

    function load() {

       // if (navigator.geolocation) {
       //     navigator.geolocation.getCurrentPosition(function (position) {
       //         initialize(position.coords.latitude, position.coords.longitude);
      //      });
       // } else {
       //     initialize();
      //  }
        initialize(36.8522478, -79.42);
    }


    



             function initialize(lat, lng) {

      



        if (map == null) {

          map = new GSCMap("map_canvas", "1646375.516113808,779832,1763616.358886192,865543.5625", 2284);
           
        }
        map.SetGoogleBase(lat, lng, 10);
        test();


        check("Parcels", 0, "images/legpar.png");
        check("Street_Centerlines", 0, "images/legpar.png");
       
        map.addListener("click", mapClickHandler);

    }


    function mapClickHandler(e) {
        var myx = e.paremeters.X;
        var myy = e.paremeters.Y;
    if (gic == "true") {
            getclickinfo(myx, myy);
        }
     //   getclickinfo(myx, myy);
     //   map.QueryLayer(layerc, 0, myx, myy, mycallback);
    }

    var myres;
    var key, val;
    function mycallback(myres) {
        var htmltab = '<div><table id="table1" border=1 cellspacing=0><tbody>';
        try {
            $.each(myres[0].attributes, function (key, val) {
                if (key == 'Photo_URL') {
                    htmltab = htmltab + "<tr><td>" + key + "</td><td><img src='" + val + "' height=300 width=200/></td><tr>";
                } else {
                    htmltab = htmltab + "<tr><td>" + key + "</td><td>" + val + "</td><tr>";
                }
            });
            htmltab = htmltab + "</tbody></table></div>";
            contentString = htmltab;
            $("#InfoWindowPane").html(contentString);
            $.mobile.changePage('#pageInfoWindow', { transition: 'pop', role: 'dialog' });
        }
        catch (err) {
        }
    }
  
    var otfc;
    var item1;
    var layerc,layercl,layersc,layerfd,layerts,layerus,layerns,layerncs,layerlu,layertsd,layer2;
    var lyrarray = [];
    var lyacount = 0;
    function check(prefixText, tindex, iconname) {
          if (prefixText == "ocsc") {
            map.gmap.setOptions({ styles: mystyle1 });
            var lyr = "Street Centerline";
            lyrs[lyrcount] = lyr;
            iname[lyrcount] = "test";
            lyrarray[lyrcount] = new GSCLocalProject("Pittsylvania", "http://mapweb.myossi.com/GSCMapService/RestService.svc/Services/Pittsylvania/", "Street Centerline", 2284);
            map.AddLayer(lyrarray[lyrcount]);
            lyrcount++;
            lyacount++;
            strcheck = true;
            $("[id='goos']").prop('checked', false);
            $("[id='goos']").button("refresh");
        }
        if (prefixText == "goos") {
            map.gmap.setOptions({ styles: mystyle2 });
            if (strcheck == true) {
            $("[id='ocsc']").prop('checked', false);
             $("[id='ocsc']").button("refresh");
             uncheck("Street Centerline", "", "");
             strcheck = false;
            }
        } else {

            lyrs[lyrcount] = prefixText;
            iname[lyrcount] = iconname;
          

            if (map != null) {
                var lyr = prefixText;
                //   var iconname = iconname;
                
                if (lyr != "") {
                      
                      lyrarray[lyrcount] = new GSCLocalProject("Pittsylvania", "http://mapweb.myossi.com/GSCMapService/RestService.svc/Services/Pittsylvania/", prefixText, 2284);
                      map.AddLayer(lyrarray[lyrcount]);
                      lyacount++;
//                  if (lyr == "Parcels") {
//                      layerc = new GSCLocalProject("Pittsylvania", "http://mapweb.myossi.com/GSCDrawRestService/RestService.svc/Services/Pittsylvania/", "Parcels", 2284);
//                       map.AddLayer(layerc);
//                  }
//                   if (lyr == "General Location Parcels") {
//                    layercl = new GSCLocalProject("Pittsylvania", "http://mapweb.myossi.com/GSCDrawRestService/RestService.svc/Services/Pittsylvania/", "General Location Parcels", 2284);
//                   map.AddLayer(layercl);
//                  }
//                  if (lyr == "Cemetary Locations") {
//                      layersc = new GSCLocalProject("Pittsylvania", "http://mapweb.myossi.com/GSCDrawRestService/RestService.svc/Services/Pittsylvania/", "Cemetary Locations", 2284);
//                      map.AddLayer(layersc);
//                  }
//                  if (lyr == "Church Locations") {
//                      layerfd = new GSCLocalProject("Pittsylvania", "http://mapweb.myossi.com/GSCDrawRestService/RestService.svc/Services/Pittsylvania/", "Church Locations", 2264);
//                       map.AddLayer(layerfd);
//                  }
//                  if (lyr == "Land Use Parcel Locations") {
//                    layerlu = new GSCLocalProject("Pittsylvania", "http://mapweb.myossi.com/GSCDrawRestService/RestService.svc/Services/Pittsylvania/", "Land Use Parcel Locations", 2284);
//                        map.AddLayer(layerlu);
//                  }
//                  if (lyr == "Land Hook Parcel Locations") {
//                       layerts = new GSCLocalProject("Pittsylvania", "http://mapweb.myossi.com/GSCDrawRestService/RestService.svc/Services/Pittsylvania/", "Land Hook Parcel Locations", 2284);
//                       map.AddLayer(layerts);
//                   }
//                   if (lyr == "Assessed Parcels") {
//                       layerlu = new GSCLocalProject("Pittsylvania", "http://mapweb.myossi.com/GSCDrawRestService/RestService.svc/Services/Pittsylvania/", "Assessed Parcels", 2284);
//                       map.AddLayer(layerlu);
//                   }
//                   if (lyr == "SCC Parcels") {
//                       layerts = new GSCLocalProject("Pittsylvania", "http://mapweb.myossi.com/GSCDrawRestService/RestService.svc/Services/Pittsylvania/", "SCC Parcels", 2284);
//                       map.AddLayer(layerts);
//                   }
               
//                  else {

//                      if (prefixText != "") {
//                          $.ajax({

//                              type: "GET",
//                              url: "queryit.aspx",
//                              data: "prefixText=" + prefixText + "&tablen=" + themetabs[tindex] + "&datecol=" + themevars[tindex] + "&iconName=" + iconname + "&datacol=" + themecols[tindex],
//                              dataType: "xml",
//                              success: function (xml) {
//                                  otfc = new OTFCollection(prefixText, 4326);

//                                  $(xml).find('marker').each(function () {
//                                      var lat = parseFloat($(this).attr('lat'));
//                                      var lng = parseFloat($(this).attr('lng'));
//                                      var inci = $(this).attr('idcol');
//                                      var markerImage = new Image();
//                                      var i = 0;
//                                      //   markerImage.src = "images\\" + $(this).attr('imgptr') + ".png";
//                                      markerImage.src = $(this).attr('imgptr');
//                                      item1 = new OTFCollectionItem(inci, i, lng, lat, markerImage, markerImage, 4326, "CENTER");

//                                      otfc.AddItem(item1);
//                                      item1.addListener("Click", cklisten);

////                                        item1.addListener("Click", function (itemClicked) {
////                                            var myx = this.X;
////                                            var myy = this.Y;
////                                            var myinci = this.Name;
////                                            getclickinfo(myx, myy, myinci);
////                                                                           });

//                                  });
//                                 map.AddOtfCollection(otfc);

//                                //  map.Refresh();

//                              },
//                              error: function (xhr, ajaxOptions, thrownError) {
//                                  //                       //  currentItem.fire("ReprojectedEvent", currentItem);
//                              }

//                              //                       url: 'queryst.aspx?prefixText=' + prefixText + '&filename=' + 'testone' + '&d1=' + $("#datepicker1").val() + '&d2=' + $("#datepicker2").val(),
//                              //                       contentType: "application/xml; charset=utf-8",
//                              //                       dataType: "text",
//                              //                       crossDomain: true,
//                              //                       success: function (data, responseCode) {

//                              //                       var reqasr = new XMLHttpRequest();

//                              //                       var pthtoovl = "http://localhost:36239/TestLight/tempovls/" + 'testone' + ".xml";

//                              //                       reqasr.open('GET', pthtoovl, true);
//                              //                       reqasr.onreadystatechange = function () {
//                              //                           if (reqasr.readyState == 4) {
//                              //                               var xmlDoc = reqasr.responseXML;
//                              //                               if (xmlDoc.documentElement != null) {

//                              //                                   var markers = xmlDoc.documentElement.getElementsByTagName("marker");
//                              //                                   otfc = new OTFCollection("col1", 4326);
//                              //                                   for (var i = 0; i < markers.length; i++) {

//                              //                                       var lat = parseFloat(markers[i].getAttribute("lat"));
//                              //                                       var lng = parseFloat(markers[i].getAttribute("lng"));
//                              //                                       var markerImage = new Image();
//                              //                                       markerImage.src = "images\\" + markers[i].getAttribute("imgptr") + ".png";
//                              //                                       item1 = new OTFCollectionItem("Location 1", i, lng, lat, markerImage, 4326, "CENTERBOTTOM");

//                              //                                       otfc.AddItem(item1);
//                              //                                   }
//                              //                                   map.AddOtfCollection(otfc);
//                              //                                 map.Refresh();
//                              //                               } //null
//                              //                           } //readystate
//                              //                       } // function
//                              //                       reqasr.send(null);

//                              //                   },
//                              //                   error: function (xhr, ajaxOptions, thrownError) {
//                              //                       //  currentItem.fire("ReprojectedEvent", currentItem);
//                              //                   }
//                          });
//                      } // prefix

//                  } // else

                  } // lyr
                  lyrcount++;
            } // map 
         }
    }
  

    function cklisten(e) {
        var myx = e.paremeters.X;
        var myy = e.paremeters.Y;
      //  var myinci = e.paremeters.Name;
        getclickinfo(myx, myy);
    }
    var lyrindx = 0;
    function uncheck(prefixText, tindex, iconname) {

     
           if (prefixText != "all") {
                for (var i = 0; i < lyrs.length; i++) {
                    if (lyrs[i] == prefixText) {
                        lyrindx = i;
                        lyrs.splice(i, 1);
                        lyrcount--;
                    }
                }

                if (map != null) {

                  //  for (var i = 0; i < lyrarray.length; i++) {
                   //     if (lyrarray[i] == prefixText) {
                            map.RemoveLayer(lyrarray[lyrindx]);
                            lyrarray[lyrindx] = null;

                            lyrarray.splice(lyrindx, 1);
                            lyacount--;
                   //     }
                  //  }
                   
//                  if (prefixText == "Parcels") {                    
//                          map.RemoveLayer(layerc);
//                          layerc = null;
//                      }
//                      if (prefixText == "Street_Centerlines") {
//                          map.RemoveLayer(layersc);
//                          layersc = null;
//                      }
//                      if (prefixText == "City Limits") {
//                          map.RemoveLayer(layercl);
//                          layercl = null;
//                      }
//                      if (prefixText == "Fire Districts") {
//                          map.RemoveLayer(layerfd);
//                          layerfd = null;
//                      }
//                      if (prefixText == "Land Use") {
//                          map.RemoveLayer(layerlu);
//                          layerlu = null;
//                      }
//                      if (prefixText == "Townships") {
//                          map.RemoveLayer(layerts);
//                          layerts = null;
//                      }
//                      if (prefixText == "US Congress 2011") {
//                          map.RemoveLayer(layerus);
//                          layerus = null;
//                      }
//                      if (prefixText == "NC House 2011") {
//                          map.RemoveLayer(layerns);
//                          layerns = null;
//                      }
//                      if (prefixText == "NC Senate 2011") {
//                          map.RemoveLayer(layerncs);
//                          layerncs = null;
//                      }
//                      if (prefixText == "School Districts 2011") {
//                          map.RemoveLayer(layertsd);
//                          layertsd = null;
//                      }
//                      if (prefixText == "Water") {
//                          map.RemoveLayer(layer2);
//                          layer2 = null;
//                      }



//                  else {

//                      map.RemoveOtfCollection(prefixText);
//                  }
                    map.Refresh();
                }
            } else {
                for (var i = 0; i < lyrs.length; i++) {
                    map.RemoveOtfCollection(lyrs[i]);

                }

                lyrs.splice(0, lyrs.length);
                lyrcount = 0;         
                map.Refresh();
            }


        

    }

    var selectionHandler;

  

    function displayInfo(widget) {
        var info = document.getElementById('dist');
        //  info.innerHTML = 'Position: ' + widget.get('position') + ', distance: ' + widget.get('distance');
        info.innerHTML = 'Distance: ' + widget.get('distance') * 0.621371192 + ' miles';
        sposx = widget.get('position');
        sdist = widget.get('distance');
    }


     var otfcs;
    var item1s;

    function cleardwid() {
        sdist = 0;
        circle.setMap(null);
        var info = document.getElementById('dist');
        info.innerHTML = ' ';
        //   map.removeOverlay(circle);
        //  circle.clear();
       // map.removeListener("click", otfcs);
          map.RemoveOtfCollection("searchnb");
        
    }

    function expexl() {
//        ss = dbs.getSortState();
//        if (ss != null) {
//            var sort = ss.field;
//            var dir = ss.direction;
//        } else {
//            var sort = '';
//            var dir = '';
        //        }
         var bbox = map.GetBoundingBox();
        // "&svalue=" + stpick + "&ch=" + map.height + "&cw=" + map.width + "&boundne=" + bbox.top + "," + bbox.right + "&boundsw=" + bbox.bottom + "," + bbox.left
        var newpop = window.open('excsv.aspx?expcsv=yes' +
                //  Ext.urlEncode(dbs.baseParams) +
                 //   '&sort=' + sort +
                 //   '&dir=' + dir +
                        '&expgtype=seares' +
                         '&filenm=' + "searchresults.csv" + "&sdist=" + sdist + "&xycen=" + sposx + "&prefixText=" + lyrs +
                         "&svalue=" + stpick + "&ch=" + map.height + "&cw=" + map.width + "&boundne=" + bbox.top + "," + bbox.right + "&boundsw=" + bbox.bottom + "," + bbox.left,
                   'name', 'width=200,height=200,status=no,location=no,menubar=no,toobar=no');
    }

    function pcard() {
        if (pcval != "") {
        window.open('prc.aspx?pval=' + pcval)
        }
    }

  function saveasimage() {

       // var polystr = "";  
//        for (var i=0; i < polylinepts.length; i++) {
//          //  polystr = polystr + polylinepts[i].lat + "," + polylinepts[i].lng + "|";
//            polystr = polystr + polylinepts[i].toString() + "|";
        //       }
        var sawidth = $('input#sawd').val();
        var saheight = $('input#saht').val();
        if (sawidth == "") { sawidth = 640; }
        if (saheight == "") { saheight = 640; } 

        var newMapType = map.gmap.getMapTypeId();
        polystr = polystr.substring(0, polystr.length - 1);        
        var currentPosition = map.gmap.getCenter();       
        window.open("http://maps.google.com/maps/api/staticmap?sensor=false&center=" +       
        currentPosition.lat() + "," + currentPosition.lng() +
      "&zoom=" + map.gmap.getZoom() + "&size=" + sawidth  + "x" + saheight + "&maptype=" + newMapType + "&path=color:0xff0000ff|weight:2|" + polystr);
    }


    function pformat() {
         
//            var popper = window.open('about:blank', '', 'width=700,height=700,status=no,location=no,menubar=yes,toolbar=yes');
//            var headstr = "<html><head><title></title></head><body>";
//            var footstr = "</body>";
//            var newstr1 = document.getElementById("mycenter").innerHTML;
//              var newstrr = newstr1.replace("height: 100%","height: 50%");
//            // alert(newstrr);
//            //var newstr2 = document.getElementById("mygrid").innerHTML;
//          //  prtstr = prtstr + document.getElementById("intab").innerHTML;
//            var newstr2 = prtstr + "</TD></TR></TABLE>";
//             popper.document.body.innerHTML = headstr+"<div>" + newstrr +"</div><div style='font:normal 6px verdana;'>" + newstr2+ "</div>" + footstr;
//         //   popper.document.body.innerHTML = headstr + "<div>" + newstr1 + "</div><div style='font:normal 6px verdana;'>" + newstr2 + "</div>" + footstr;


//            //  popper.window.print(); 
//             return false;


             var dataUrl = [];
             var i = 0;

             $("#mycenter canvas").filter(function () {
                 dataUrl.push(this.toDataURL("image/png"));
             });

             var DocumentContainer = document.getElementById('mycenter');
           //  var DocumentContainer = document.getElementById('map_canvas');
             var DocumentContainer_temp = $(DocumentContainer).clone();

             $(DocumentContainer_temp).find('canvas').each(function () {
                $(this).replaceWith('<img title="abc" src="' + dataUrl[i] + '" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px;">');
               //  $(this).replaceWith('<img title="abc" src="' + dataUrl[i] + '">');
                 i++;
             });

             baseCanvas = document.createElement('canvas');
             var img = new Image();



             img.onload = function () {
                 baseCanvas.getContext('2d').drawImage(img, 0, 0);
                 baseCanvas.toDataURL('image/png'); // WORKS FINE NOW!
             }
             img.src = '<DATAURL>';

            // if (typeof imgOrURL == 'object')
             //    imgOrURL = imgOrURL.src;
             //   var myimg = baseCanvas.toDataURL("image/png");
          
         //     window.win = open(img.src);
          //  setTimeout('win.document.execCommand("SaveAs",true,)', 500);



             var newstr1 = DocumentContainer_temp.html();

//             var oWin = window.open("about:blank", "_blank");
//             var strDataURI = baseCanvas.toDataURL("image/png;base64");
//             oWin.document.write('<img src="' + strDataURI + '"/>');
//         //  oWin.document.write(img.src);
//           oWin.document.close();
//           oWin.document.execCommand('SaveAs', true, "test.png")
//           oWin.close();
//             var imgstr = "";
//             for (var j = 0; j < i; j++) {
//                 imgstr = imgstr + "<img src='" + dataUrl[j] + "'>";
//             }
//             var newstr1 = imgstr;
           var newstrr = newstr1.replace("height:100%", "height:50%");
           var newstrrch = newstr1.replace("height:100%", "height:400px");
           var newstrrch2 = newstrrch.replace("width:100%", "width:650px");
           //  prtstr = "<TABLE BORDER=0 CELLSPACING=0 BORDERCOLOR='#000000' CELLPADDING=0 WIDTH='450'><TR><TD>";
             var newstr2 = document.getElementById("intab").innerHTML;
             newstr2 = newstr2.replace('border="1"', 'border="0"');
           //  var newstr2 = prtstr + "</TD></TR></TABLE>";
             //   var addhtml =  "<div style='font:normal 6px verdana;'>" + newstr2+ "</div>";
             var headstr = "";
             if ($.browser.webkit) {
         
                 headstr = "<html><head><title></title><style type='text/css'>td {font-family: Verdana; font-size: 6pt;} div {-webkit-print-color-adjust: exact !important; }</style></head><body><div id='hasbackgroundimage'>";
             }
             else if ($.browser.mozilla) {

                 headstr = "<html><head><title></title><style type='text/css'>td {font-family: Verdana; font-size: 6pt;}</style></head><body><div id='hasbackgroundimage'>";
             } 
             else {
                 headstr = "<html><head><title></title><style type='text/css'>td {font-family: Verdana; font-size: 6pt;}</style></head><body><div style='height:50% !important; .gmnoprint{display:none !important;}'>";
             }
             var footstr = "</body>";

             var WindowObject;
             if ($.browser.webkit) {
                 // WindowObject = window.open('', "PrintMap", "width=740,height=700,top=200,left=250,resizable=yes");
                 var addhtml = newstr2;
                 popup1 = window.open('about:blank', 'popup1');
                 popup1.document.writeln(headstr + newstrrch2 + "</div>");
                 popup1.document.writeln(addhtml + footstr);
                 popup1.document.close();
                  popup1.focus();
              //   popup1.print();
             //   popup1.close();

             }
             else if ($.browser.mozilla) {
                 // WindowObject = window.open('', "PrintMap", "width=740,height=700,top=200,left=250,resizable=yes");
                 var addhtml = newstr2;
             
                 popup1 = window.open('about:blank', 'popup1');
                 popup1.document.writeln(headstr + newstrrch2 + "</div>");
                 popup1.document.writeln(addhtml + footstr);
                 popup1.document.close();
                 popup1.focus();
                 //   popup1.print();
                 //   popup1.close();
                // alert(newstrr);

             }
             //  var WindowObject = window.open('', "PrintMap", "width=740,height=700,top=200,left=250,resizable=yes");
             //  var popper = window.open('', 'PrintMap', 'width=700,height=700,top=200,left=250,resizable=yes,status=no,location=no,menubar=yes,toolbar=yes');
             //   popper.document.body.innerHTML = headstr + newstrr + newstr2 + footstr;
             else {
                 WindowObject = window.open('PrintMap', 'PrintMap', 'width=700,height=700,top=200,left=250,resizable=yes,status=no,location=no,menubar=yes,toolbar=yes');

                 var addhtml = newstr2;
                 WindowObject.document.writeln(headstr + newstrr + "</div>");
                 WindowObject.document.writeln(addhtml + footstr);
             }
        //    WindowObject.document.close();
          //  WindowObject.focus();
        //   WindowObject.print();
         //   WindowObject.close();

           

             return false;
//               setTimeout(function () {
//                  popup1.location = 'LOCATION_ON_THE_SAME_ORIGIN_AS_THE_OPENER';

//              }, 5000);


         }

//         function loadImages(sources, callback) {
//             var images = {};
//             var loadedImages = 0;
//             var numImages = 0;
//             // get num of sources
//             for (var src in sources) {
//                 numImages++;
//             }
//             for (var src in sources) {
//                 images[src] = new Image();
//                 images[src].onload = function () {
//                     if (++loadedImages >= numImages) {
//                         callback(images);
//                     }
//                 };
//                 images[src].src = sources[src];
//             }
//         }
//         var canvas = document.getElementById('myCanvas');
//         var context = canvas.getContext('2d');

//         var sources = {
//             darthVader: 'http://www.html5canvastutorials.com/demos/assets/darth-vader.jpg',
//             yoda: 'http://www.html5canvastutorials.com/demos/assets/yoda.jpg'
//         };

//         loadImages(sources, function (images) {
//             context.drawImage(images.darthVader, 100, 30, 200, 137);
//             context.drawImage(images.yoda, 350, 55, 93, 104);
//         });



//    function clqlayer(e) {       
//        var myx = e.paremeters.X;
//        var myy = e.paremeters.Y;      
//        map.QueryLayer(layer, 0, myx, myy, mycallback);
//    }

//    function otfcs(e) {
//        var myx = e.paremeters.X;
//        var myy = e.paremeters.Y;
//        map.QueryLayer(nblayer, 0, myx, myy, mycallback);
//    }

  

 
    function getData(sfor) {

   
      var xmlSchema = new $.ig.DataSchema("xml", {
      fields: [
              { name: "pin", xpath: "pin", width: "20px" },
                { name: "parcel_id", xpath: "parcel_id", width: "20px" },
                 { name: "owner1", xpath: "owner1", width: "20px" },
                { name: "total_acre", xpath: "total_acre", width: "20px" },
                { name: "prop_addr", xpath: "prop_addr", width: "20px" },
                { name: "bk_pg", xpath: "bk_pg", width: "20px" },
                { name: "land_val", xpath: "land_val", width: "20px" },
                { name: "bldg_val", xpath: "bldg_val", width: "20px" },
                { name: "total_val", xpath: "total_val", width: "20px" },
                { name: "sale_date", xpath: "sale_date", width: "20px" },
                { name: "sale_price", xpath: "sale_price", width: "20px" }, 
                { name: "mail_addr1", xpath: "mail_addr1", width: "20px" },
                { name: "mail_addr2", xpath: "mail_addr2", width: "20px" },
                { name: "city", xpath: "city", width: "20px" },
                { name: "zip_code", xpath: "zip_code", width: "20px" }      
               ],         
    searchField: "//data"
     });

     var xmlres = null;
     $('#grid1').igGrid('destroy');
     var bbox = map.GetBoundingBox();

        $.ajax({

         
            type: 'GET',
            url: 'WebService.asmx/GetSearch',

          //  data: 'prefixText=' + lyrs + '&ne=' + bbox.top + "," + bbox.right + '&sw=' + bbox.bottom + "," + bbox.left + '&ch=' + map.height + '&cw=' + map.width + '&sdist=' + sdist + '&xycen=' + sposx + '&sfor=' + sfor,
              data: 'prefixText=' + sfor + '&start=1&limit=10',
            //  data: "{SearchCriteria: '" + $("#SearchText").val() + "'}",
            contentType: 'text/xml; charset=utf-8',
            dataType: 'text',
            success: function (msg) {

                var xmlDoc = msg;
                xmlres = msg;
                var ds = new $.ig.DataSource({
                    type: "xml",
                    dataSource: xmlDoc,
                    schema: xmlSchema
                });
                ds.dataBind();
                ///
                otfcs = new OTFCollection("searchnb", 4326);

                $(xmlDoc).find('data').each(function () {
                    //                    var lat = parseFloat($(this).find('yo').text());
                    //                    var lng = parseFloat($(this).find('xo').text());
                    //                    var inci = $(this).find('acct_name').text();
                    //                    var markerImage = new Image();
                    //                    var i = 0;
                    //                    markerImage.src = "images\\mm_20_purple.png";
                    //                    item1s = new OTFCollectionItem(inci, i, lng, lat, markerImage, markerImage, 4326, "CENTER");

                    //                    otfcs.AddItem(item1s);
                    //             
                    //                                           item1s.addListener("Click", function (itemClicked) {
                    //                                               var myx = this.X;
                    //                                               var myy = this.Y;
                    //                                               var myinci = this.Name;
                    //                                               getclickinfo(myx, myy, myinci);
                    //                                           });
                });
                //   map.AddOtfCollection(otfcs);

                //   map.Refresh();



                ///
                $("#grid1").igGrid({
                    autoGenerateColumns: true,
                    columns: [              
 { headerText: "pin", key: "pin", width: "80px" },
                { headerText: "parcel_id", key: "parcel_id", width: "80px" },
                 { headerText: "owner1", key: "owner1", width: "80px" },
                { headerText: "total_acre", key: "total_acre", width: "80px" },
                { headerText: "prop_addr", key: "prop_addr", width: "80px" },
                { headerText: "bk_pg", key: "bk_pg", width: "80px" },
                { headerText: "land_val", key: "land_val", width: "80px" },
                { headerText: "bldg_val", key: "bldg_val", width: "80px" },
                { headerText: "total_val", key: "total_val", width: "80px" },
                { headerText: "sale_date", key: "sale_date", width: "80px" },
                { headerText: "sale_price", key: "sale_price", width: "80px" },
                { headerText: "mail_addr1", key: "mail_addr1", width: "80px" },
                { headerText: "mail_addr2", key: "mail_addr2", width: "80px" },
                { headerText: "city", key: "city", width: "80px" },
                { headerText: "zip_code", key: "zip_code", width: "80px" }

    
    ],
                    dataSource: ds.data(),
                //    width: "100%",
                    features: [
                    //  { name: 'Paging', type: "local", pageSize: 25 },
                {name: 'Sorting', type: 'local', columnSettings: [] },
                { name: 'Selection', mode: 'row', multipleSelection: false, activation: true, rowSelectionChanged: selectionHandler },
                { name: 'Resizing' }
            ]

                });



            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert("Something bad happened. Code: " + xhr.status + ". Error: " + xhr.responseText);
            }
        });

}






function selectionHandler(event, args) {
   // var ztc = $('#grid1').igGridSelection('selectCell', args.row, 0);

 //   var cells = $('#grid1').igGridSelection('selectedCells');
  //  var rows = $('#grid1').igGridSelection(args.row);


    var dataview = $('#grid1').data('igGrid').dataSource.dataView();

//    var golng = parseFloat(dataview[args.row.index]['xo']);
    var svalue = dataview[args.row.index]['pin'];

          var skey = "pin";
     

                    var bbox = map.GetBoundingBox();
                    $.ajax({
                        type: "GET",
                        url: "search.aspx",
                        data: "&skey=pin" + "&svalue=" + svalue + "&canht=" + map.height + "&canwd=" + map.width + "&boundne=" + bbox.top + "," + bbox.right + "&boundsw=" + bbox.bottom + "," + bbox.left,
                        dataType: "xml",
                        success: function (xmlres, textStatus, $xhr) {
                            $(xmlres).find("line").each(function () {
                                polylinePoints.length = 0;
                                $(xmlres).find("point").each(function () {
                                    latitude = parseFloat($(this).attr('lat'));
                                    longitude = parseFloat($(this).attr('lng'));
                                    polylinePoints.push(new google.maps.LatLng(latitude, longitude));
                                });
                                //    <bbounds maxlat="36.44228" maxlng="-80.8747" minlat="35.99669" minlng="-81.5489"/>

                                var line = new google.maps.Polyline({
                                    path: polylinePoints,
                                    strokeColor: '#0000ff',
                                    strokeOpacity: 1.0,
                                    strokeWeight: 3
                                });

                                map.DrawPolylineOnGoogleMap(line);
                            });
                            var bb = {};
                            bb.left = $(xmlres).find("bbounds").attr('minlng');
                            bb.top = $(xmlres).find("bbounds").attr('maxlat');
                            bb.right = $(xmlres).find("bbounds").attr('maxlng');
                            bb.bottom = $(xmlres).find("bbounds").attr('minlat');


                            map.ZoomToBoundingBox(bb, false);
                            map.Refresh();
                            //   polyline = new google.maps.Polyline(polylinePoints, color, width, 1, { clickable: false });
                            //  map.addOverlay(polyline);
                            var htmltab = "<table border=1 cellspacing=0>";
                            //   $("div#dialog").append("<div><P>Test Test</P></div>"); 
                            //   $dialog.dialog({ title: clickinci });
                            $(xmlres).find('data').each(function () {
                                var nme = $(this).find('name').text();
                                var cnt = $(this).find('content').text();
                                htmltab = htmltab + "<tr><td>" + nme + "</td><td>" + cnt + "</td><tr>";
                            })
                            htmltab = htmltab + "</table>";
                            $("#intab").html("<div>" + htmltab + "</div>");
                        }
                    });
//    var otfg = new OTFCollection("gridpt", 4326);
//    var items;
//    var markerImage = new Image();
//    markerImage.src = "images/cirred_16.png";
//    itemg = new OTFCollectionItem("test", "gridpt", golng, golat, markerImage, markerImage, 4326, "CENTER");

//    otfg.AddItem(itemg);
//    map.AddOtfCollection(otfg);




//    map.SetCenter(golng, golat);

//    map.Refresh();


}

         var polystr = "";

var polylinesclick = [];
    var clickx, clicky;
    function getclickinfo(clickx, clicky) {

        for (var i = 0; i < polylinesclick.length; i++) {
            map.ClearPolylineOnGoogleMap(polylinesclick[i]);
        }

        polylinesclick = [];


        if (clickx != "") {
            var bbox = map.GetBoundingBox();
            $.ajax({

                type: "GET",
                url: "click.aspx",
                data: "x=" + clickx + "&y=" + clicky + "&canht=" + map.height + "&canwd=" + map.width + "&boundne=" + bbox.top + "," + bbox.right + "&boundsw=" + bbox.bottom + "," + bbox.left + "&infolyr=" + infolyr,
                dataType: "xml",
                success: function (xml) {
                    $(xml).find("line").each(function () {

                        var polylinepts = [];
                        polystr = "";
                        $(this).find("point").each(function () {
                            latitude = parseFloat($(this).attr('lat'));
                            longitude = parseFloat($(this).attr('lng'));
                            polylinepts.push(new google.maps.LatLng(latitude, longitude));
                               polystr = polystr + latitude.toString() + "," + longitude.toString() + "|";
                        });


                        var line = new google.maps.Polyline({
                            path: polylinepts,
                            strokeColor: '#ff0000',
                            strokeOpacity: 1.0,
                            strokeWeight: 3
                        });
                        map.DrawPolylineOnGoogleMap(line);

                        polylinesclick.push(line);

                    });

//                    var bb = {};
//                    bb.left = $(xml).find("bbounds").attr('minlng');
//                    bb.top = $(xml).find("bbounds").attr('maxlat');
//                    bb.right = $(xml).find("bbounds").attr('maxlng');
//                    bb.bottom = $(xml).find("bbounds").attr('minlat');
//                    map.ZoomToBoundingBox(bb, false);
//                    map.Refresh();




//                    polylinePoints.length = 0;
//                    $(xml).find("point").each(function () {
//                        latitude = parseFloat($(this).attr('lat'));
//                        longitude = parseFloat($(this).attr('lng'));
//                        polylinePoints.push(new google.maps.LatLng(latitude, longitude));
//                    });
//                    //    <bbounds maxlat="36.44228" maxlng="-80.8747" minlat="35.99669" minlng="-81.5489"/>
//                    //                    var bb = {};
//                    //                    bb.left = $(xmlres).find("bbounds").attr('minlng');
//                    //                    bb.top = $(xmlres).find("bbounds").attr('maxlat');
//                    //                    bb.right = $(xmlres).find("bbounds").attr('maxlng');
//                    //                    bb.bottom = $(xmlres).find("bbounds").attr('minlat');
//                    if (line != null) {
//                        map.ClearPolylineOnGoogleMap(line);
//                     //   map.Refresh();
//                        line = null;
//                    }
//                    line = new google.maps.Polyline({
//                        path: polylinePoints,
//                        strokeColor: '#ff0000',
//                        strokeOpacity: 1.0,
//                        strokeWeight: 3
//                    });

//                    map.DrawPolylineOnGoogleMap(line);
//                    // map.ZoomToBoundingBox(bb, false);
                    map.Refresh();

                    prtstr = "<TABLE BORDER=0 CELLSPACING=0 BORDERCOLOR='#000000' CELLPADDING=0 WIDTH='450'><TR><TD>";

                    var htmltab = "<table id='gridTable' border=1 cellspacing=0>";

                    $(xml).find('data').each(function () {
                        var nme = $(this).find('name').text();
                        var cnt = $(this).find('content').text();
                        if (nme == "JOIN_GPIN") {
                            pcval = cnt;
                        }
                           if (nme == "GRID_NO" || nme == "GRID_NO_Z" ||  nme == "ALPHA" || nme == "FIRM_PAN") {
                            htmltab = htmltab + "<tr id='gotopdf'><td><a href='#'>" + nme + "</a></td><td>" + cnt + "</td></tr>";

                        } else {
                        htmltab = htmltab + "<tr><td>" + nme + "</td><td>" + cnt + "</td><tr>";
                        }
                        prtstr = prtstr + "<tr><td><pre><span class='inner-pre' style='font-size: 8px'>" + nme + "</span></pre></td><td><pre><span class='inner-pre' style='font-size: 8px'>" + cnt + "</span></pre></td><tr>";


                    })
                    htmltab = htmltab + "</table>";
                    $("#intab").html("<div>" + htmltab + "</div>");
                }
            });


         //   item1.removeListener("Click", cklisten);

            //                  var myDialogX = $(map).position().left - $(map).outerWidth();
            //                  var myDialogY = $(map).position().top - ($(document).scrollTop() + $('.ui-dialog').outerHeight());
            //                  $dialog.dialog('option', 'position', [myDialogX,myDialogY]);
         //   $dialog.dialog('open');

            //   var $dialog = $('<div></div>');
            //                 var $dialog = $('#dialog'); 
            //                 $dialog.dialog('destroy'); 
            //              $dialog.dialog({
            //                  autoOpen: false,
            //                  bgiframe: true,
            //                  modal: true, 
            //                    title: "test2"                  

            //                  });

            //        $("#dialog").dialog();
        }
    }

    window.onload = load; 
 
    
    </script>


 </body>
</html>
